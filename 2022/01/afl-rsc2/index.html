<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>AFL æºç åˆ†æï¼ˆäºŒï¼‰è·¯å¾„è¦†ç›–ä¿¡æ¯ &amp; é˜Ÿåˆ—ä¼˜èƒœè€… - Stay Hungry</title><meta name="Description" content="This is My New Hugo Site"><meta property="og:title" content="AFL æºç åˆ†æï¼ˆäºŒï¼‰è·¯å¾„è¦†ç›–ä¿¡æ¯ &amp; é˜Ÿåˆ—ä¼˜èƒœè€…" />
<meta property="og:description" content="ç´§æ¥ä¸Šä¸€éƒ¨åˆ†ï¼Œæœ¬æ–‡å°†æ›´è¿›ä¸€æ­¥æ¢è®¨ AFL å¦‚ä½•åœ¨è¿è¡Œæ—¶ä¿å­˜å’Œåˆ†æè·¯å¾„è¦†ç›–ä¿¡æ¯ï¼Œä»¥åŠé˜Ÿåˆ—ä¼˜èƒœè€…çš„é€‰å–æ€è·¯ã€‚å‰è€…ä¸ºå¯å‘å¼å˜å¼‚æä¾›å¯¼å‘ï¼Œåè€…ä¸º culling the corpus çš„åŸºç¡€ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://xidoo.top/2022/01/afl-rsc2/" /><meta property="og:image" content="http://xidoo.top/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-23T11:01:02+08:00" />
<meta property="article:modified_time" content="2022-01-23T11:01:02+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://xidoo.top/logo.png"/>

<meta name="twitter:title" content="AFL æºç åˆ†æï¼ˆäºŒï¼‰è·¯å¾„è¦†ç›–ä¿¡æ¯ &amp; é˜Ÿåˆ—ä¼˜èƒœè€…"/>
<meta name="twitter:description" content="ç´§æ¥ä¸Šä¸€éƒ¨åˆ†ï¼Œæœ¬æ–‡å°†æ›´è¿›ä¸€æ­¥æ¢è®¨ AFL å¦‚ä½•åœ¨è¿è¡Œæ—¶ä¿å­˜å’Œåˆ†æè·¯å¾„è¦†ç›–ä¿¡æ¯ï¼Œä»¥åŠé˜Ÿåˆ—ä¼˜èƒœè€…çš„é€‰å–æ€è·¯ã€‚å‰è€…ä¸ºå¯å‘å¼å˜å¼‚æä¾›å¯¼å‘ï¼Œåè€…ä¸º culling the corpus çš„åŸºç¡€ã€‚"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://xidoo.top/2022/01/afl-rsc2/" /><link rel="prev" href="http://xidoo.top/2022/01/afl-rsc/" /><link rel="next" href="http://xidoo.top/2022/01/afl-rsc3/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "AFL æºç åˆ†æï¼ˆäºŒï¼‰è·¯å¾„è¦†ç›–ä¿¡æ¯ \u0026 é˜Ÿåˆ—ä¼˜èƒœè€…",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/xidoo.top\/2022\/01\/afl-rsc2\/"
        },"genre": "posts","wordcount":  1309 ,
        "url": "http:\/\/xidoo.top\/2022\/01\/afl-rsc2\/","datePublished": "2022-01-23T11:01:02+08:00","dateModified": "2022-01-23T11:01:02+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "x1do0"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Stay Hungry">ğŸš© Stay hungry</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/friends/"> Friends </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Stay Hungry">ğŸš© Stay hungry</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/friends/" title="">Friends</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">AFL æºç åˆ†æï¼ˆäºŒï¼‰è·¯å¾„è¦†ç›–ä¿¡æ¯ &amp; é˜Ÿåˆ—ä¼˜èƒœè€…</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>x1do0</a></span>&nbsp;<span class="post-category">included in <a href="/categories/general/"><i class="far fa-folder fa-fw"></i>General</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-01-23">2022-01-23</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1309 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;7 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#è·¯å¾„è¦†ç›–ä¿¡æ¯çš„ä¿å­˜ä¸åˆ†æ">è·¯å¾„è¦†ç›–ä¿¡æ¯çš„ä¿å­˜ä¸åˆ†æ</a>
      <ul>
        <li><a href="#åˆå§‹åŒ–">åˆå§‹åŒ–</a></li>
        <li><a href="#è¿è¡Œæ—¶è·å–">è¿è¡Œæ—¶è·å–</a></li>
        <li><a href="#ä»¥è·¯å¾„è¦†ç›–ä¸ºæŒ‡å¯¼">ä»¥è·¯å¾„è¦†ç›–ä¸ºæŒ‡å¯¼</a></li>
      </ul>
    </li>
    <li><a href="#ä¼˜èƒœè€…ç­–ç•¥">ä¼˜èƒœè€…ç­–ç•¥</a>
      <ul>
        <li><a href="#æŒ‡å¯¼å› å­æ ‡è®°">æŒ‡å¯¼å› å­æ ‡è®°</a></li>
        <li><a href="#å‰ªæå› å­æ ‡è®°">å‰ªæå› å­æ ‡è®°</a></li>
        <li><a href="#æŒ‡å¯¼æµ‹è¯•è¿‡ç¨‹">æŒ‡å¯¼æµ‹è¯•è¿‡ç¨‹</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>ç´§æ¥ä¸Šä¸€éƒ¨åˆ†ï¼Œæœ¬æ–‡å°†æ›´è¿›ä¸€æ­¥æ¢è®¨ AFL å¦‚ä½•åœ¨è¿è¡Œæ—¶ä¿å­˜å’Œåˆ†æè·¯å¾„è¦†ç›–ä¿¡æ¯ï¼Œä»¥åŠé˜Ÿåˆ—ä¼˜èƒœè€…çš„é€‰å–æ€è·¯ã€‚å‰è€…ä¸ºå¯å‘å¼å˜å¼‚æä¾›å¯¼å‘ï¼Œåè€…ä¸º <a href="https://xidoo.top/2022/01/afl-white-book/#4-%E8%AF%AD%E6%96%99%E5%BA%93%E7%B2%BE%E7%AE%80-culling-the-corpus" target="_blank" rel="noopener noreffer">culling the corpus</a> çš„åŸºç¡€ã€‚</p>
<h2 id="è·¯å¾„è¦†ç›–ä¿¡æ¯çš„ä¿å­˜ä¸åˆ†æ">è·¯å¾„è¦†ç›–ä¿¡æ¯çš„ä¿å­˜ä¸åˆ†æ</h2>
<p>è¿™éƒ¨åˆ†ä¸»è¦æ¶‰åŠåˆ° has_new_bits</p>
<h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>
<p><a href="https://xidoo.top/2022/01/afl-rsc/#check-configuration" target="_blank" rel="noopener noreffer">å‰æ–‡</a> æåˆ° AFL ä¼šè°ƒç”¨ <code>setup_shm</code>  åˆå§‹åŒ–å†…å­˜ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œ<code>virgin_bits</code> è¢«åˆå§‹åŒ–ä¸ºä¸€æ®µäºŒè¿›åˆ¶ä¸€çš„å†…å­˜å¹¶å…¨ç¨‹ç»´æŠ¤ä½œä¸ºæ€»è¡¨ï¼Œå¯¹äºå…¶ä¸­çš„æ¯ä¸ªå­—èŠ‚ï¼Œå…¨ä¸€åˆ™ä»£è¡¨å¯¹åº”å…ƒç»„æœªè¢«è®¿é—®ã€‚<code>shmget</code> åˆå§‹åŒ–ä¸€æ®µåŒæ ·å¤§å°çš„å…±äº«å†…å­˜ï¼Œé€šè¿‡ IPC è¿›è¡Œè¿›ç¨‹é—´çš„é€šä¿¡ä¸åŒæ­¥ã€‚å¦‚æœä¸æ˜¯ dumb æ¨¡å¼å°±ä¼šå°†æ­¤å…±äº«å†…å­˜çš„æ ‡è¯†ç¬¦è®¾ç½®åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œæ–¹ä¾¿å­è¿›ç¨‹ï¼ˆè§ forkserver éƒ¨åˆ†ï¼‰é”å®šã€‚AFL æœ¬èº«é€šè¿‡ <code>trace_bits</code> å˜é‡æŒ‡å‘è¿™æ®µå…±äº«å†…å­˜ï¼Œç”¨æ¥è®°å½•æ¯æ¬¡è¿è¡Œå¾—åˆ°çš„è·¯å¾„æ‰§è¡Œæƒ…å†µã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">EXP_ST</span> <span class="kt">void</span> <span class="nf">setup_shm</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">u8</span><span class="o">*</span> <span class="n">shm_str</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">in_bitmap</span><span class="p">)</span> <span class="n">memset</span><span class="p">(</span><span class="n">virgin_bits</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">MAP_SIZE</span><span class="p">);</span>

  <span class="n">memset</span><span class="p">(</span><span class="n">virgin_tmout</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">MAP_SIZE</span><span class="p">);</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">virgin_crash</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">MAP_SIZE</span><span class="p">);</span>

  <span class="n">shm_id</span> <span class="o">=</span> <span class="n">shmget</span><span class="p">(</span><span class="n">IPC_PRIVATE</span><span class="p">,</span> <span class="n">MAP_SIZE</span><span class="p">,</span> <span class="n">IPC_CREAT</span> <span class="o">|</span> <span class="n">IPC_EXCL</span> <span class="o">|</span> <span class="mo">0600</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">shm_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">PFATAL</span><span class="p">(</span><span class="s">&#34;shmget() failed&#34;</span><span class="p">);</span>

  <span class="n">atexit</span><span class="p">(</span><span class="n">remove_shm</span><span class="p">);</span>

  <span class="n">shm_str</span> <span class="o">=</span> <span class="n">alloc_printf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">shm_id</span><span class="p">);</span>

  <span class="cm">/* If somebody is asking us to fuzz instrumented binaries in dumb mode,
</span><span class="cm">     we don&#39;t want them to detect instrumentation, since we won&#39;t be sending
</span><span class="cm">     fork server commands. This should be replaced with better auto-detection
</span><span class="cm">     later on, perhaps? */</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dumb_mode</span><span class="p">)</span> <span class="n">setenv</span><span class="p">(</span><span class="n">SHM_ENV_VAR</span><span class="p">,</span> <span class="n">shm_str</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

  <span class="n">ck_free</span><span class="p">(</span><span class="n">shm_str</span><span class="p">);</span>

  <span class="n">trace_bits</span> <span class="o">=</span> <span class="n">shmat</span><span class="p">(</span><span class="n">shm_id</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="n">trace_bits</span> <span class="o">==</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">PFATAL</span><span class="p">(</span><span class="s">&#34;shmat() failed&#34;</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="è¿è¡Œæ—¶è·å–">è¿è¡Œæ—¶è·å–</h3>
<p>æ¯æ¬¡ <code>run_target()</code> çš„æœ€å¼€å§‹ä¼šæ¸…é›¶ <code>trace_bits</code> ï¼Œåœ¨æ‰§è¡Œæ—¶ç”¨å¦‚ä¸‹æ’æ¡©ä»£ç æ”¹å˜ <code>trace_bits</code> ï¼ˆ è§ afl-as.h/__afl_maybe_log ï¼‰å›å¿† <a href="https://xidoo.top/2022/01/afl-white-book/#1-%E8%A6%86%E7%9B%96%E5%BA%A6%E6%B5%8B%E9%87%8F-coverage-measurements" target="_blank" rel="noopener noreffer">ç™½çš®ä¹¦ </a>ä¸­å¯¹äºæ’æ¡©ä»£ç çš„ä¼ªä»£ç æè¿°ã€‚</p>
<p>åœ¨ afl-as.h/trampoline_fmt_64 ä¸­ï¼Œæ’æ¡©ä»£ç ç”¨ rcx å­˜å‚¨ä¸€ä¸ª <code>(random() % (MAP_SIZE))</code> èŒƒå›´çš„éšæœºå€¼ï¼Œå› æ­¤åœ¨å¤„ç†åˆ°æŸä¸ªåˆ†æ”¯å¹¶ä¸”éœ€è¦æ’å…¥æ’æ¡©ä»£ç æ—¶ï¼Œafl-as ä¼šäº§ç”Ÿä¸€ä¸ªæ­¤èŒƒå›´çš„éšæœºæ•°ä½œä¸ºæ­¤è¾¹çš„ ID. å¯¹åº”äºä¼ªä»£ç ç¬¬ä¸€è¡Œ <code>cur_location = &lt;COMPILE_TIME_RANDOM&gt;;</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="k">static</span> <span class="k">const</span> <span class="n">u8</span><span class="o">*</span> <span class="n">trampoline_fmt_64</span> <span class="o">=</span>
 
  <span class="s">&#34;/* --- AFL TRAMPOLINE (64-BIT) --- */</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="c1">//...
</span><span class="c1"></span>  <span class="s">&#34;movq %%rcx,  8(%%rsp)</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;movq $0x%08x, %%rcx</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;call __afl_maybe_log</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="c1">//...
</span><span class="c1"></span>  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;/* --- END --- */</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿›å…¥åˆ° __afl_maybe_logï¼Œé¦–å…ˆä¼šæ£€æŸ¥å…±äº«å†…å­˜æ˜¯å¦è®¾ç½®å¥½</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c">  <span class="s">&#34;  /* Check if SHM region is already mapped. */</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;  movl  __afl_area_ptr, %edx</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;  testl %edx, %edx</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;  je    __afl_setup</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;__afl_store:</span><span class="se">\n</span><span class="s">&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åå¼€å§‹å¦‚ä¸‹è®¡ç®—ï¼Œå¯è§ <code>__afl_pre_loc</code>  ä¾¿æ˜¯ä¼ªä»£ç ä¸­ <code>prev_location</code> ï¼Œä¿å­˜ä¸Šä¸€ä¸ªå…ƒç»„ä½ç½®ã€‚åœ¨å¯¹ <code>cur_location</code> è¿›è¡Œå¼‚æˆ–åå°† <code>cur_location</code> å³ç§»ä¸€ä½ä½œä¸ºæ–°çš„ <code>prev_location</code> .</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cp">#ifndef COVERAGE_ONLY
</span><span class="cp"></span>  <span class="s">&#34;  movl __afl_prev_loc, %edi</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;  xorl %ecx, %edi</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;  shrl $1, %ecx</span><span class="se">\n</span><span class="s">&#34;</span>
  <span class="s">&#34;  movl %ecx, __afl_prev_loc</span><span class="se">\n</span><span class="s">&#34;</span>
<span class="cp">#else
</span><span class="cp"></span>  <span class="s">&#34;  movl %ecx, %edi</span><span class="se">\n</span><span class="s">&#34;</span>
<span class="cp">#endif </span><span class="cm">/* ^!COVERAGE_ONLY */</span><span class="cp">
</span><span class="cp"></span>  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åç”¨ rcx ä¸ rdx æ¥æ”¹å˜ <code>trace_bits</code> å†…å­˜åŒºåŸŸã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cp">#ifdef SKIP_COUNTS
</span><span class="cp"></span>  <span class="s">&#34;  orb  $1, (%rdx, %rcx, 1)</span><span class="se">\n</span><span class="s">&#34;</span>
<span class="cp">#else
</span><span class="cp"></span>  <span class="s">&#34;  incb (%rdx, %rcx, 1)</span><span class="se">\n</span><span class="s">&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™ä¾¿æ˜¯åœ¨ä¸€æ¬¡æ‰§è¡Œä¸­æ’æ¡©ä»£ç å¯¹è·¯å¾„è¦†ç›–è¡¨åšçš„æ”¹å˜ã€‚</p>
<h3 id="ä»¥è·¯å¾„è¦†ç›–ä¸ºæŒ‡å¯¼">ä»¥è·¯å¾„è¦†ç›–ä¸ºæŒ‡å¯¼</h3>
<p>åœ¨ä¸Šä¸€æ­¥å¾—åˆ°æ”¹å˜ <code>trace_bits</code> åè°ƒç”¨ <code>classify_counts(trace_bits)</code>  å¯¹å…¶åšé¢„å¤„ç†ï¼Œæ­¤å‡½æ•°å°†ä¼ å…¥çš„å†…å­˜æŒ‰æ¯ä¸¤ä¸ªå­—èŠ‚åš <code>count_class_lookup16</code> å˜æ¢ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">classify_counts</span><span class="p">(</span><span class="n">u64</span><span class="o">*</span> <span class="n">mem</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//...
</span><span class="c1"></span>      <span class="n">mem16</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_class_lookup16</span><span class="p">[</span><span class="n">mem16</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
      <span class="n">mem16</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_class_lookup16</span><span class="p">[</span><span class="n">mem16</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span>
      <span class="n">mem16</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_class_lookup16</span><span class="p">[</span><span class="n">mem16</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>
      <span class="n">mem16</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_class_lookup16</span><span class="p">[</span><span class="n">mem16</span><span class="p">[</span><span class="mi">3</span><span class="p">]];</span>
	  <span class="c1">//...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ <code>count_class_lookup8</code> ä¾¿æ˜¯ç™½çš®ä¹¦æåˆ°çš„æ¡¶æ“ä½œï¼Œå°†ä¸€å­—èŠ‚å®½çš„å˜é‡æŒ‰å¦‚ä¸‹æ˜ å°„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">count_class_lookup8</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    
      <span class="p">[</span><span class="mi">0</span><span class="p">]</span>           <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">// 00000000
</span><span class="c1"></span>      <span class="p">[</span><span class="mi">1</span><span class="p">]</span>           <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">// 00000001
</span><span class="c1"></span>      <span class="p">[</span><span class="mi">2</span><span class="p">]</span>           <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="c1">// 00000010
</span><span class="c1"></span>      <span class="p">[</span><span class="mi">3</span><span class="p">]</span>           <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="c1">// 00000100
</span><span class="c1"></span>      <span class="p">[</span><span class="mi">4</span> <span class="p">...</span> <span class="mi">7</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="c1">// 00001000
</span><span class="c1"></span>      <span class="p">[</span><span class="mi">8</span> <span class="p">...</span> <span class="mi">15</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">16</span><span class="p">,</span><span class="c1">// 00010000
</span><span class="c1"></span>      <span class="p">[</span><span class="mi">16</span> <span class="p">...</span> <span class="mi">31</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">32</span><span class="p">,</span><span class="c1">// 00100000
</span><span class="c1"></span>      <span class="p">[</span><span class="mi">32</span> <span class="p">...</span> <span class="mi">127</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">64</span><span class="p">,</span><span class="c1">// 01000000
</span><span class="c1"></span>      <span class="p">[</span><span class="mi">128</span> <span class="p">...</span> <span class="mi">255</span><span class="p">]</span> <span class="o">=</span> <span class="mi">128</span><span class="c1">// 10000000
</span><span class="c1"></span>      
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>äºŒå­—èŠ‚å®½çš„ <code>count_class_lookup16</code> å°±æ˜¯å°†å‰åä¸¤ä¸ªå­—èŠ‚åˆ†å¼€è®¡ç®— <code>count_class_lookup8</code>ï¼Œå¯èƒ½æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="k">static</span> <span class="n">u16</span> <span class="n">count_class_lookup16</span><span class="p">[</span><span class="mi">65536</span><span class="p">];</span>

<span class="n">EXP_ST</span> <span class="kt">void</span> <span class="nf">init_count_class16</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">u32</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">b1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">b1</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">b1</span><span class="o">++</span><span class="p">)</span> 
    <span class="k">for</span> <span class="p">(</span><span class="n">b2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">b2</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">b2</span><span class="o">++</span><span class="p">)</span>
      <span class="n">count_class_lookup16</span><span class="p">[(</span><span class="n">b1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span><span class="p">]</span> <span class="o">=</span> 
        <span class="p">(</span><span class="n">count_class_lookup8</span><span class="p">[</span><span class="n">b1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
        <span class="n">count_class_lookup8</span><span class="p">[</span><span class="n">b2</span><span class="p">];</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>run_target()</code> ç»“æŸåä¼šè°ƒç”¨ <code>has_new_bits(virgin_bits) </code> å»åˆ¤æ–­æ˜¯å¦äº§ç”Ÿäº†æ–°çš„å…ƒç»„ï¼Œè¯¥å‡½æ•°å°† <code>trace_bits</code> ä¸ <code>virgin_bits</code> åšä¸€ç³»åˆ—å¯¹æ¯”ï¼Œå¾—åˆ°è¿”å›å€¼ï¼š1 ä»£è¡¨å…ƒç»„å‘½ä¸­æ•°æ”¹å˜ï¼Œ2 ä»£è¡¨æ–°å…ƒç»„äº§ç”Ÿã€‚è¿™ä¸ªå‡½æ•°ä¼šå°†ä¸Šè¿°ä¸¤ä¸ªå¾…æ¯”è¾ƒçš„å†…å­˜ä»¥ 8 ä¸ª å­—èŠ‚ä¸ºä¸€ç»„ï¼ˆ64ä½ä¸‹ï¼‰ï¼Œå¯¹æ¯ç»„è¿›è¡Œå¦‚ä¸‹å¯¹æ¯”åˆ¤æ–­ï¼Œæœ€åæ¸…é›¶ <code>virgin_bits</code> ç›¸åº”ä½ï¼Œä»£è¡¨æ­¤ä½ç½®å¯¹åº”å…ƒç»„å·²è¢«å‘½ä¸­ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c">    <span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">*</span><span class="n">current</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">unlikely</span><span class="p">(</span><span class="o">*</span><span class="n">current</span> <span class="o">&amp;</span> <span class="o">*</span><span class="n">virgin</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>

        <span class="n">u8</span><span class="o">*</span> <span class="n">cur</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="o">*</span><span class="p">)</span><span class="n">current</span><span class="p">;</span>
        <span class="n">u8</span><span class="o">*</span> <span class="n">vir</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="o">*</span><span class="p">)</span><span class="n">virgin</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">cur</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">vir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">cur</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">vir</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">||</span>
            <span class="p">(</span><span class="n">cur</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">vir</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">cur</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">vir</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">||</span>
            <span class="p">(</span><span class="n">cur</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">vir</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">cur</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">vir</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">||</span>
            <span class="p">(</span><span class="n">cur</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">vir</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">cur</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">vir</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">))</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">else</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="o">*</span><span class="n">virgin</span> <span class="o">&amp;=</span> <span class="o">~*</span><span class="n">current</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>åº”è¯¥ä¸ä¼šæœ‰äººåƒæˆ‘ä¸€æ ·å› ä¸ºä¸æ³¨æ„ &amp;&amp; ä¸ == è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§è€Œçœ‹ä¸æ‡‚é€»è¾‘å§ï¼Ÿ</p>
</blockquote>
<p>åŒæ ·ï¼Œsave_if_interesting ä¸­ä¹Ÿä¼šè°ƒç”¨ has_new_bits è·å–è¿”å›å€¼ï¼Œå¦‚æœä¸º 0 åˆ™ä»£è¡¨æœ¬æ¬¡æ‰§è¡Œæ²¡æœ‰æ–°çš„è·¯å¾„äº§ç”Ÿï¼Œè¯¥æµ‹è¯•ç”¨ä¾‹ä¸ä¼šè¢«æ”¾å…¥æµ‹è¯•é˜Ÿåˆ—ï¼Œä¹Ÿä¸ä¼šå†™å…¥ç£ç›˜ã€‚åªæœ‰è¿”å› 1 æˆ– 2 æ—¶æ‰ä¼šä¿ç•™æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼ŒAFL çš„å¯å‘å¼å˜å¼‚å°±ä½“ç°åœ¨æ­¤ï¼Œåªæœ‰å½“ has_new_bits è¿”å›é 0 æ—¶ï¼ˆå³æµ‹è¯•ç”¨ä¾‹å¸¦æ¥äº†å…ƒç»„å‘½ä¸­æ¬¡æ•°çš„æ”¹å˜æˆ–æ–°å‘½ä¸­å…ƒç»„çš„äº§ç”Ÿï¼‰è¯¥æµ‹è¯•ç”¨ä¾‹æ‰ä¼šè¢«æ”¾å…¥æµ‹è¯•é˜Ÿåˆ—è¢«è¿›ä¸€æ­¥å˜å¼‚ã€‚å¦‚ç™½çš®ä¹¦è¯´æ‰€ï¼Œè¿™æ ·çš„å¯å‘å¼æ€æƒ³ç»™ AFL å¸¦æ¥äº†è¶…è¿‡ Blind fuzzing, ä»¥ Block coverage, Edge coverage ä¸ºå¯¼å‘çš„ fuzzing æ€§èƒ½ã€‚</p>
<h2 id="ä¼˜èƒœè€…ç­–ç•¥">ä¼˜èƒœè€…ç­–ç•¥</h2>
<p>æ­¤éƒ¨åˆ†ä¸»è¦æ¶‰åŠåˆ° update_bitmap_score, cull_queue .</p>
<h3 id="æŒ‡å¯¼å› å­æ ‡è®°">æŒ‡å¯¼å› å­æ ‡è®°</h3>
<p>é˜Ÿåˆ—ç”¨é“¾è¡¨å®ç°ï¼Œæ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œç»“æ„ä½“ä¸º <code>queue_entry</code>ï¼Œç€é‡æ³¨æ„å®ƒçš„æˆå‘˜å˜é‡ <code>trace_mini</code>  ä¸ <code>tc_ref</code> ï¼Œåœ¨è¿™ä¸€éƒ¨åˆ†èµ·åˆ°é‡è¦æ•ˆæœã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="k">struct</span> <span class="n">queue_entry</span> <span class="p">{</span>

  <span class="n">u8</span><span class="o">*</span> <span class="n">fname</span><span class="p">;</span>                          <span class="cm">/* File name for the test case      */</span>
  <span class="n">u32</span> <span class="n">len</span><span class="p">;</span>                            <span class="cm">/* Input length                     */</span>

  <span class="n">u8</span>  <span class="n">cal_failed</span><span class="p">,</span>                     <span class="cm">/* Calibration failed?              */</span>
      <span class="n">trim_done</span><span class="p">,</span>                      <span class="cm">/* Trimmed?                         */</span>
      <span class="n">was_fuzzed</span><span class="p">,</span>                     <span class="cm">/* Had any fuzzing done yet?        */</span>
      <span class="n">passed_det</span><span class="p">,</span>                     <span class="cm">/* Deterministic stages passed?     */</span>
      <span class="n">has_new_cov</span><span class="p">,</span>                    <span class="cm">/* Triggers new coverage?           */</span>
      <span class="n">var_behavior</span><span class="p">,</span>                   <span class="cm">/* Variable behavior?               */</span>
      <span class="n">favored</span><span class="p">,</span>                        <span class="cm">/* Currently favored?               */</span>
      <span class="n">fs_redundant</span><span class="p">;</span>                   <span class="cm">/* Marked as redundant in the fs?   */</span>

  <span class="n">u32</span> <span class="n">bitmap_size</span><span class="p">,</span>                    <span class="cm">/* Number of bits set in bitmap     */</span>
      <span class="n">exec_cksum</span><span class="p">;</span>                     <span class="cm">/* Checksum of the execution trace  */</span>

  <span class="n">u64</span> <span class="n">exec_us</span><span class="p">,</span>                        <span class="cm">/* Execution time (us)              */</span>
      <span class="n">handicap</span><span class="p">,</span>                       <span class="cm">/* Number of queue cycles behind    */</span>
      <span class="n">depth</span><span class="p">;</span>                          <span class="cm">/* Path depth                       */</span>

  <span class="n">u8</span><span class="o">*</span> <span class="n">trace_mini</span><span class="p">;</span>                     <span class="cm">/* Trace bytes, if kept             */</span>
  <span class="n">u32</span> <span class="n">tc_ref</span><span class="p">;</span>                         <span class="cm">/* Trace bytes ref count            */</span>

  <span class="k">struct</span> <span class="n">queue_entry</span> <span class="o">*</span><span class="n">next</span><span class="p">,</span>           <span class="cm">/* Next element, if any             */</span>
                     <span class="o">*</span><span class="n">next_100</span><span class="p">;</span>       <span class="cm">/* 100 elements ahead               */</span>

<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>AFL ç»´æŠ¤ä¸€ä¸ªæ•°ç»„ <code>top_rated</code> ï¼Œå®ƒçš„æ¯ä¸ªæ¡ç›®å¯¹åº” bitmap ä¸­ä¸€ä¸ªå­—èŠ‚ï¼ˆå³ä¸€ä¸ªå…ƒç»„çš„å‘½ä¸­æƒ…å†µï¼‰ã€‚ <code>static struct queue_entry* top_rated[MAP_SIZE];  </code> å¯¹è¡¨ä¸­æ¯ä¸€ä¸ªå­—èŠ‚ï¼Œå³æ¯ä¸€ä¸ªå…ƒç»„ï¼Œéƒ½ç”¨ <code>top_rated</code> ä¸€ä¸€å¯¹åº”åˆ°ä¸€ä¸ªé˜Ÿåˆ—å…ƒç´ ï¼Œä»£è¡¨è¿™ä¸ªå…ƒç»„çš„â€œæœ€ä½³æµ‹è¯•ç”¨ä¾‹â€ã€‚</p>
<p>å¯¹æ¯ä¸ªé˜Ÿåˆ—å…ƒç´ å®šä¹‰å‚è€ƒå€¼ <code>u64 fav_factor = q-&gt;exec_us * q-&gt;len;</code> AFL ç”¨æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œæ—¶é—´ä¸é•¿åº¦çš„ä¹˜ç§¯ä½œä¸ºâ€œæœ€ä½³æµ‹è¯•ç”¨ä¾‹â€çš„åº¦é‡æ ‡å‡†ï¼Œå¦‚ç™½çš®ä¹¦æ‰€è¯´ï¼Œç®€å•å´æœ‰æ•ˆã€‚</p>
<p>åœ¨ <code>run_target()</code> ä¸­å¾—åˆ° bitmap åä¼šè°ƒç”¨ update_bitmap_score å‡½æ•°ã€‚å®ƒéå† <code>trace_bits</code> çš„æ¯ä¸ªå­—èŠ‚ï¼Œå¦‚æœå½“å‰å­—èŠ‚ä¸º 1ï¼ˆå³æ­¤å…ƒç»„åœ¨æ­¤æ¬¡æ‰§è¡Œæ—¶å‘½ä¸­ï¼‰åˆ™åˆå§‹åŒ– <code>top_rated</code> æ¡ç›®ä¸ºæ­¤é˜Ÿåˆ—å…ƒç´ ã€‚å½“ä»¥åæ‰§è¡Œåˆå‘½ä¸­æ­¤å…ƒç»„æ—¶ï¼ˆå³å½“ <code>top_rated</code> å¯¹åº”æ¡ç›®ä¸ä¸ºç©ºæ—¶ï¼‰ï¼Œè¯¥å…ƒç»„ä¼šé€‰å–æ›´å°å‚è€ƒå€¼çš„é˜Ÿåˆ—å…ƒç´ ä½œä¸ºå…¶ <code>top_rated</code> æ¡ç›®ï¼Œå¹¶å°† <code>score_changed</code> ç½® 1 ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé˜Ÿåˆ—å…ƒç´ çš„æˆå‘˜å˜é‡ <code>tc_ref</code> è®°å½•äº†æ­¤é˜Ÿåˆ—å…ƒç´ è¢«å…ƒç»„è®¤ä¸ºæ˜¯ä¼˜èƒœè€…çš„æ¬¡æ•°ï¼Œå¦‚æœå‡ä¸º 0ï¼Œåˆ™ä¼šå°† <code>trace_mini</code> ç©ºé—´é‡Šæ”¾ï¼›å¦‚æœä» 0 åˆ° 1ï¼Œåˆ™ä¸º æˆå‘˜å˜é‡ <code>trace_mini </code> åˆ†é…å†…å­˜ï¼Œå¹¶è°ƒç”¨ minimize_bits æ¥ç¼©å‡ <code>trace_bits</code> å¾—åˆ° <code>trace_mini</code> ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c">    <span class="k">if</span> <span class="p">(</span><span class="n">top_rated</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fav_factor</span> <span class="o">&gt;</span> <span class="n">top_rated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">exec_us</span> <span class="o">*</span> <span class="n">top_rated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!--</span><span class="n">top_rated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">tc_ref</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// å‡åˆ° 0 åˆ™é‡Šæ”¾å†…å­˜
</span><span class="c1"></span>            <span class="n">ck_free</span><span class="p">(</span><span class="n">top_rated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">trace_mini</span><span class="p">);</span>
            <span class="n">top_rated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">trace_mini</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">top_rated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">;</span>
    <span class="n">q</span><span class="o">-&gt;</span><span class="n">tc_ref</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">trace_mini</span><span class="p">)</span> <span class="p">{</span>	
        <span class="n">q</span><span class="o">-&gt;</span><span class="n">trace_mini</span> <span class="o">=</span> <span class="n">ck_alloc</span><span class="p">(</span><span class="n">MAP_SIZE</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// åˆ†é…å†…å­˜
</span><span class="c1"></span>        <span class="n">minimize_bits</span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">trace_mini</span><span class="p">,</span> <span class="n">trace_bits</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">score_changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>update_bitmap_score çš„ä¼˜åŒ–æ–¹å‘ä¸ºï¼š<code>trace_bits</code> ä¸å˜ä½†é˜Ÿåˆ—å…ƒç´ çš„ <code>fav_factor</code> è¶‹äºæœ€å°ã€‚</p>
<p>è€Œ minimize_bits å‡½æ•°å°±æ˜¯ç®€å•åœ°å°† <code>trace_bits </code>  ç¼©å‡åˆ°åŸæ¥çš„ 1/8 å­˜å‚¨åˆ° <code>trace_mini</code> ,  <code>trace_mini</code> çš„ä¸€ä¸ª bit å¯¹åº”äº† <code>trace_bits</code> çš„ä¸€ä¸ªå­—èŠ‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ ·çš„å‹ç¼©æ–¹å¼å»æ‰äº† <code>trace_bits</code> ä¸­å…ƒç»„å‘½ä¸­æ¬¡æ•°çš„ä¿¡æ¯ï¼Œè€Œåªä¿ç•™äº†è¯¥å…ƒç»„æ˜¯å¦å‘½ä¸­çš„ä¿¡æ¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* Compact trace bytes into a smaller bitmap. We effectively just drop the
</span><span class="cm">   count information here. This is called only sporadically, for some
</span><span class="cm">   new paths. */</span>
 
<span class="k">static</span> <span class="kt">void</span> <span class="nf">minimize_bits</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">src</span><span class="p">)</span> <span class="p">{</span>
 
    <span class="n">u32</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
    <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAP_SIZE</span><span class="p">)</span> <span class="p">{</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">src</span><span class="o">++</span><span class="p">))</span> <span class="n">dst</span><span class="p">[</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">]</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">);</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
 
    <span class="p">}</span> 
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°è¿‡ç¨‹å¾—åˆ°çš„ <code>trace_mini</code>, <code>top_rated</code>, <code>score_changed</code> å°†ä½œä¸ºæŒ‡å¯¼å› å­ï¼ŒæŒ‡å¯¼åç»­è¿‡ç¨‹ã€‚</p>
<h3 id="å‰ªæå› å­æ ‡è®°">å‰ªæå› å­æ ‡è®°</h3>
<p><code>run_target()</code> åä¼šè°ƒç”¨ cull_queue å¯¹é˜Ÿåˆ—è¿›è¡Œå‰ªæã€‚è¯¥å‡½æ•°å¦‚ä¸‹ï¼š</p>
<p>åˆå§‹åŒ– <code>temp_v</code>  ä¸ºå…¨äºŒè¿›åˆ¶ä¸€çš„å†…å­˜ï¼Œå¤§å°ä¸ <code>trace_mini</code> ç›¸åŒï¼Œå®ƒçš„ä¸€ä¸ª bit åŒæ ·å¯¹åº”äº† <code>trace_bits</code> çš„ä¸€ä¸ªå­—èŠ‚ï¼Œç”¨äºåœ¨è¿™ä¸€å‡½æ•°ä¸­æ ‡è¯†æ²¡æœ‰è¢«è®¿é—®çš„å…ƒç»„ã€‚</p>
<p>è¿™é‡Œæœ¬è´¨ä¸Šè¿˜æ˜¯ä½¿ç”¨äº†è´ªå¿ƒç®—æ³•ã€‚å‰é¢æåˆ°ï¼Œé˜Ÿåˆ—å…ƒç´ çš„ <code>trace_mini</code> ä¿å­˜äº†è¯¥æµ‹è¯•ç”¨ä¾‹å‘½ä¸­çš„å…ƒç»„ä¿¡æ¯ã€‚è€Œ <code>top_rated</code> æŒ‡ç¤ºçš„é˜Ÿåˆ—å…ƒç´ çš„ <code>trace_mini</code> ä¾¿æ˜¯åœ¨ä¼˜èƒœè€…åœˆå­å†…çš„æµ‹è¯•ç”¨ä¾‹å‘½ä¸­çš„å…ƒç»„ä¿¡æ¯ã€‚ä½†ä¸æ˜¯æ‰€æœ‰ä¼˜èƒœè€…çš„ <code>favored</code> éƒ½è¢«ç½® 1ï¼ŒAFL è´ªå¿ƒåœ°è®¤ä¸ºå¯¹äºæ¯ä¸ªè¢«å‘½ä¸­çš„å…ƒç»„ï¼Œéå†æ—¶ç¬¬ä¸€æ¬¡é‡åˆ°çš„ä¼˜èƒœè€…å°±æ˜¯â€œæ›´å—å–œçˆ±çš„â€ï¼Œå¹¶ç½®æˆå‘˜å˜é‡ <code>favored</code> ä¸º 1.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c">	  <span class="k">if</span> <span class="p">(</span><span class="n">top_rated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">temp_v</span><span class="p">[</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">))))</span> <span class="p">{</span>

      <span class="n">u32</span> <span class="n">j</span> <span class="o">=</span> <span class="n">MAP_SIZE</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>

      <span class="cm">/* Remove all bits belonging to the current entry from temp_v. */</span>

      <span class="k">while</span> <span class="p">(</span><span class="n">j</span><span class="o">--</span><span class="p">)</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">top_rated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">trace_mini</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
          <span class="n">temp_v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">top_rated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">trace_mini</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>

      <span class="n">top_rated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">favored</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">queued_favored</span><span class="o">++</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">top_rated</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">was_fuzzed</span><span class="p">)</span> <span class="n">pending_favored</span><span class="o">++</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>æ ‡è®°å¥½â€œæ›´å—å–œçˆ±â€çš„æµ‹è¯•ç”¨ä¾‹ä¹‹åï¼Œéå†æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è°ƒç”¨ mark_as_redundant åšå¤„ç†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c">  <span class="n">q</span> <span class="o">=</span> <span class="n">queue</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">mark_as_redundant</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="o">!</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">favored</span><span class="p">);</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨ mark_as_redundant ä¸­ï¼Œæœªè¢« <code>favored </code> æ ‡è®°çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå…¶æˆå‘˜å˜é‡ <code>fs_redundant</code> ä¼šè¢«ç½® 1ï¼Œå¹¶æ”¾å…¥ out_dir/queue/.state/redundant_edges/ æ–‡ä»¶å¤¹ä¸­ã€‚å¦‚æœå®ƒåœ¨åç»­åˆè¢« <code>favored</code> æ ‡è®°ï¼Œåˆ™ä»æ–‡ä»¶å¤¹ä¸­åˆ å»ï¼›åä¹‹åŒç†ã€‚</p>
<p>æ‰€ä»¥æ€»çš„æ¥è¯´ cull_queue å¹²äº†ä¸¤ä»¶äº‹æƒ…ï¼Œé€‰æ‹©ä¼˜èƒœè€…å¹¶æ ‡è®°ä¸º <code>favored</code> ï¼Œå¹¶å°†å‰©ä½™æµ‹è¯•ç”¨ä¾‹æ ‡è®°ä¸º <code>fs_redundant</code> å¹¶åœ¨ç£ç›˜ä¸­ç•™ä¸‹åå­—ã€‚æ­£å¦‚ç™½çš®ä¹¦æ‰€è¯´ï¼ŒAFL å¹¶æœªå°†éä¼˜èƒœè€…ç›´æ¥å‰”é™¤ã€‚</p>
<h3 id="æŒ‡å¯¼æµ‹è¯•è¿‡ç¨‹">æŒ‡å¯¼æµ‹è¯•è¿‡ç¨‹</h3>
<p>åœ¨ fuzz_one å‡½æ•°ä¸­</p>
<ul>
<li>
<p>pending_favored æ—¶ï¼Œwas_fuzzed æˆ–æ˜¯ éä¼˜èƒœè€… ä¼šä»¥ <code>SKIP_TO_NEW_PROB</code> æ¦‚ç‡è·³è¿‡æµ‹è¯•ã€‚</p>
</li>
<li>
<p>æ²¡æœ‰ pending_favored æ—¶</p>
<ul>
<li>éä¼˜èƒœè€…
<ul>
<li>æ²¡è¢« fuzz è¿‡ä¼šä»¥ <code>SKIP_NFAV_NEW_PROB</code> æ¦‚ç‡è·³è¿‡ã€‚</li>
<li>è¢« fuzz è¿‡ä»¥ <code>SKIP_NFAV_OLD_PROB</code> æ¦‚ç‡è·³è¿‡ã€‚</li>
</ul>
</li>
<li>ä¼˜èƒœè€…ä¸è·³è¿‡</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c">  <span class="k">if</span> <span class="p">(</span><span class="n">pending_favored</span><span class="p">)</span> <span class="p">{</span>

    <span class="cm">/* If we have any favored, non-fuzzed new arrivals in the queue,
</span><span class="cm">       possibly skip to them at the expense of already-fuzzed or non-favored
</span><span class="cm">       cases. */</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">queue_cur</span><span class="o">-&gt;</span><span class="n">was_fuzzed</span> <span class="o">||</span> <span class="o">!</span><span class="n">queue_cur</span><span class="o">-&gt;</span><span class="n">favored</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="n">UR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">SKIP_TO_NEW_PROB</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dumb_mode</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">queue_cur</span><span class="o">-&gt;</span><span class="n">favored</span> <span class="o">&amp;&amp;</span> <span class="n">queued_paths</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>

    <span class="cm">/* Otherwise, still possibly skip non-favored cases, albeit less often.
</span><span class="cm">       The odds of skipping stuff are higher for already-fuzzed inputs and
</span><span class="cm">       lower for never-fuzzed entries. */</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">queue_cycle</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">queue_cur</span><span class="o">-&gt;</span><span class="n">was_fuzzed</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">UR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">SKIP_NFAV_NEW_PROB</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">UR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">SKIP_NFAV_OLD_PROB</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

    <span class="p">}</span>

  <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™ä¾¿æ˜¯å‰ªæå› å­æŒ‡å¯¼æµ‹è¯•é˜Ÿåˆ—å‡å°çš„å…¨è¿‡ç¨‹ã€‚</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-01-23</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/2022/01/afl-rsc2/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://xidoo.top/2022/01/afl-rsc2/" data-title="AFL æºç åˆ†æï¼ˆäºŒï¼‰è·¯å¾„è¦†ç›–ä¿¡æ¯ &amp; é˜Ÿåˆ—ä¼˜èƒœè€…"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://xidoo.top/2022/01/afl-rsc2/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="http://xidoo.top/2022/01/afl-rsc2/" data-title="AFL æºç åˆ†æï¼ˆäºŒï¼‰è·¯å¾„è¦†ç›–ä¿¡æ¯ &amp; é˜Ÿåˆ—ä¼˜èƒœè€…" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://xidoo.top/2022/01/afl-rsc2/" data-title="AFL æºç åˆ†æï¼ˆäºŒï¼‰è·¯å¾„è¦†ç›–ä¿¡æ¯ &amp; é˜Ÿåˆ—ä¼˜èƒœè€…"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="Share on å¾®åš" data-sharer="weibo" data-url="http://xidoo.top/2022/01/afl-rsc2/" data-title="AFL æºç åˆ†æï¼ˆäºŒï¼‰è·¯å¾„è¦†ç›–ä¿¡æ¯ &amp; é˜Ÿåˆ—ä¼˜èƒœè€…"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="Share on Myspace" data-sharer="myspace" data-url="http://xidoo.top/2022/01/afl-rsc2/" data-title="AFL æºç åˆ†æï¼ˆäºŒï¼‰è·¯å¾„è¦†ç›–ä¿¡æ¯ &amp; é˜Ÿåˆ—ä¼˜èƒœè€…" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="Share on Blogger" data-sharer="blogger" data-url="http://xidoo.top/2022/01/afl-rsc2/" data-title="AFL æºç åˆ†æï¼ˆäºŒï¼‰è·¯å¾„è¦†ç›–ä¿¡æ¯ &amp; é˜Ÿåˆ—ä¼˜èƒœè€…" data-description=""><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="Share on Evernote" data-sharer="evernote" data-url="http://xidoo.top/2022/01/afl-rsc2/" data-title="AFL æºç åˆ†æï¼ˆäºŒï¼‰è·¯å¾„è¦†ç›–ä¿¡æ¯ &amp; é˜Ÿåˆ—ä¼˜èƒœè€…"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2022/01/afl-rsc/" class="prev" rel="prev" title="AFL æºç åˆ†æï¼ˆä¸€ï¼‰ä» 0 åˆ° 1 å†åˆ° n"><i class="fas fa-angle-left fa-fw"></i>AFL æºç åˆ†æï¼ˆä¸€ï¼‰ä» 0 åˆ° 1 å†åˆ° n</a>
            <a href="/2022/01/afl-rsc3/" class="next" rel="next" title="AFL æºç åˆ†æï¼ˆä¸‰ï¼‰forkserver è¯¦è§£">AFL æºç åˆ†æï¼ˆä¸‰ï¼‰forkserver è¯¦è§£<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ğŸ´â€â˜ ï¸ Love it, Make magic</div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">x1do0</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":15},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
